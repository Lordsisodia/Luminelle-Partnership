../api/customer/order.ts:23:  const shop = process.env.SHOPIFY_STORE_DOMAIN || ''
../api/customer/order.ts:27:  const discover = await fetch(`https://${shop}/.well-known/shopify/customer-account-api/unstable`).then(r => r.json()).catch(() => null)
../api/customer/orders.ts:10:  const shop = process.env.SHOPIFY_STORE_DOMAIN || ''
../api/customer/orders.ts:17:  const discover = await fetch(`https://${shop}/.well-known/shopify/customer-account-api/unstable`).then(r => r.json()).catch(() => null)
../functions/api/customer/order.ts:13:  const shop = env.SHOPIFY_STORE_DOMAIN || ''
../functions/api/customer/order.ts:18:  const discover = await fetch(`https://${shop}/.well-known/shopify/customer-account-api/unstable`)
../src/lib/product.ts:20:  // Legacy placeholder; replaced when Shopify is configured and callers use `fetchProductByHandle`.
../functions/api/customer/orders.ts:9:  const shop = env.SHOPIFY_STORE_DOMAIN || ''
../functions/api/customer/orders.ts:15:  const discover = await fetch(`https://${shop}/.well-known/shopify/customer-account-api/unstable`)
../functions/api/shopify/auth.ts:4:import { isValidShopDomain } from '../../_lib/shopifyOAuth'
../functions/api/shopify/auth.ts:15:  const apiKey = env.SHOPIFY_API_KEY || ''
../functions/api/shopify/auth.ts:16:  const scopes = env.SCOPES || env.SHOPIFY_SCOPES || 'read_products,write_products'
../functions/api/shopify/auth.ts:17:  const appUrl = env.SHOPIFY_APP_URL || url.origin
../functions/api/shopify/auth.ts:18:  const callback = new URL('/api/shopify/auth/callback', appUrl).toString()
../functions/api/shopify/auth.ts:32:    `shopify_state=${state}; ${cookieBase}`,
../functions/api/shopify/auth.ts:33:    `shopify_shop=${shop}; ${cookieBase}`,
../functions/api/shopify/webhooks/customers-data-request.ts:3:import { verifyShopifyWebhook } from '../../../_lib/shopifyWebhooks'
../functions/api/shopify/webhooks/customers-data-request.ts:9:  const { valid, body } = await verifyShopifyWebhook(request, env)
../functions/api/shopify/webhooks/customers-data-request.ts:13:    request.headers.get('x-shopify-shop-domain') ||
../functions/api/shopify/webhooks/customers-data-request.ts:14:    request.headers.get('X-Shopify-Shop-Domain') ||
../functions/api/shopify/webhooks/fulfillments-create.ts:3:import { verifyShopifyWebhook } from '../../../_lib/shopifyWebhooks'
../functions/api/shopify/webhooks/fulfillments-create.ts:32:  const { valid, body } = await verifyShopifyWebhook(request, env)
../functions/api/shopify/webhooks/fulfillments-create.ts:36:    request.headers.get('x-shopify-delivery-id') ||
../functions/api/shopify/webhooks/fulfillments-create.ts:37:    request.headers.get('x-shopify-webhook-id') ||
../functions/api/shopify/webhooks/fulfillments-create.ts:38:    request.headers.get('X-Shopify-Webhook-Id') ||
../functions/api/shopify/webhooks/fulfillments-create.ts:43:    request.headers.get('x-shopify-shop-domain') ||
../functions/api/shopify/webhooks/fulfillments-create.ts:44:    request.headers.get('X-Shopify-Shop-Domain') ||
../functions/api/shopify/webhooks/fulfillments-create.ts:107:        [{ id: userId, email: existing?.email ?? attrs.lumelle_user_email ?? null, updated_at: new Date().toISOString(), raw: { source: 'shopify_webhook' } }],
../functions/api/shopify/webhooks/fulfillments-create.ts:115:          source: `shopify:fulfillment:${shop}:${orderId}`,
../functions/api/shopify/webhooks/fulfillments-create.ts:122:            shopify_delivery_id: deliveryId || null,
../functions/api/shopify/webhooks/orders-create.ts:25:    request.headers.get('x-shopify-hmac-sha256')?.trim() || request.headers.get('X-Shopify-Hmac-Sha256')?.trim() || ''
../functions/api/shopify/webhooks/orders-create.ts:31:  // Shopify signs webhook payloads with the app secret (`SHOPIFY_API_SECRET`).
../functions/api/shopify/webhooks/orders-create.ts:32:  // Some deployments historically used a separate env var name (`SHOPIFY_WEBHOOK_SECRET`) which
../functions/api/shopify/webhooks/orders-create.ts:34:  const apiSecret = env.SHOPIFY_API_SECRET || ''
../functions/api/shopify/webhooks/orders-create.ts:35:  const webhookSecret = env.SHOPIFY_WEBHOOK_SECRET || ''
../functions/api/shopify/webhooks/orders-create.ts:36:  if (!apiSecret && !webhookSecret) return text('Missing Shopify webhook secret', { status: 500 })
../functions/api/shopify/webhooks/orders-create.ts:53:  const deliveryId = request.headers.get('x-shopify-delivery-id')?.trim() || ''
../functions/api/shopify/webhooks/orders-create.ts:55:  const shop = (request.headers.get('x-shopify-shop-domain') || body?.shop_domain || body?.domain || '').toString()
../functions/api/shopify/webhooks/orders-create.ts:71:      // Do the network call after returning 200 to Shopify (reduce retries / timeouts).
../functions/api/shopify/webhooks/orders-create.ts:78:            source: 'shopify_webhook',
../functions/api/shopify/webhooks/orders-create.ts:80:            shopify_delivery_id: deliveryId || undefined,
../functions/api/shopify/webhooks/app-uninstalled.ts:3:import { verifyShopifyWebhook } from '../../../_lib/shopifyWebhooks'
../functions/api/shopify/webhooks/app-uninstalled.ts:9:  const { valid, body } = await verifyShopifyWebhook(request, env)
../functions/api/shopify/webhooks/app-uninstalled.ts:13:    request.headers.get('x-shopify-shop-domain') ||
../functions/api/shopify/webhooks/app-uninstalled.ts:14:    request.headers.get('X-Shopify-Shop-Domain') ||
../functions/api/shopify/webhooks/customers-redact.ts:3:import { verifyShopifyWebhook } from '../../../_lib/shopifyWebhooks'
../functions/api/shopify/webhooks/customers-redact.ts:9:  const { valid, body } = await verifyShopifyWebhook(request, env)
../functions/api/shopify/webhooks/customers-redact.ts:13:    request.headers.get('x-shopify-shop-domain') ||
../functions/api/shopify/webhooks/customers-redact.ts:14:    request.headers.get('X-Shopify-Shop-Domain') ||
../functions/api/shopify/webhooks/shop-redact.ts:3:import { verifyShopifyWebhook } from '../../../_lib/shopifyWebhooks'
../functions/api/shopify/webhooks/shop-redact.ts:9:  const { valid, body } = await verifyShopifyWebhook(request, env)
../functions/api/shopify/webhooks/shop-redact.ts:13:    request.headers.get('x-shopify-shop-domain') ||
../functions/api/shopify/webhooks/shop-redact.ts:14:    request.headers.get('X-Shopify-Shop-Domain') ||
../api/_lib/db.ts:13:export async function ensureShopifySessionTable() {
../api/_lib/db.ts:15:  // Minimal session store for Shopify offline tokens (used by /api/shopify/auth/callback and admin helpers).
../api/_lib/db.ts:30:  await ensureShopifySessionTable()
../functions/api/shopify/webhooks/orders-updated.ts:3:import { verifyShopifyWebhook } from '../../../_lib/shopifyWebhooks'
../functions/api/shopify/webhooks/orders-updated.ts:39:  const { valid, body } = await verifyShopifyWebhook(request, env)
../functions/api/shopify/webhooks/orders-updated.ts:43:    request.headers.get('x-shopify-delivery-id') ||
../functions/api/shopify/webhooks/orders-updated.ts:44:    request.headers.get('x-shopify-webhook-id') ||
../functions/api/shopify/webhooks/orders-updated.ts:45:    request.headers.get('X-Shopify-Webhook-Id') ||
../functions/api/shopify/webhooks/orders-updated.ts:50:    request.headers.get('x-shopify-shop-domain') ||
../functions/api/shopify/webhooks/orders-updated.ts:51:    request.headers.get('X-Shopify-Shop-Domain') ||
../functions/api/shopify/webhooks/orders-updated.ts:86:          [{ id: userId, email: order.email ?? attrs.lumelle_user_email ?? null, updated_at: new Date().toISOString(), raw: { source: 'shopify_webhook' } }],
../functions/api/shopify/webhooks/orders-updated.ts:90:        const awardSource = `shopify:fulfillment:${shop}:${orderId}`
../functions/api/shopify/webhooks/orders-updated.ts:108:              source: `shopify:refund:${shop}:${orderId}`,
../functions/api/shopify/webhooks/customers-update.ts:3:import { verifyShopifyWebhook } from '../../../_lib/shopifyWebhooks'
../functions/api/shopify/webhooks/customers-update.ts:10:  const { valid, body } = await verifyShopifyWebhook(request, env)
../functions/api/shopify/webhooks/customers-update.ts:14:    request.headers.get('x-shopify-delivery-id') ||
../functions/api/shopify/webhooks/customers-update.ts:15:    request.headers.get('x-shopify-webhook-id') ||
../functions/api/shopify/webhooks/customers-update.ts:16:    request.headers.get('X-Shopify-Webhook-Id') ||
../functions/api/shopify/webhooks/customers-update.ts:21:    request.headers.get('x-shopify-shop-domain') ||
../functions/api/shopify/webhooks/customers-update.ts:22:    request.headers.get('X-Shopify-Shop-Domain') ||
../functions/api/shopify/webhooks/customers-delete.ts:3:import { verifyShopifyWebhook } from '../../../_lib/shopifyWebhooks'
../functions/api/shopify/webhooks/customers-delete.ts:10:  const { valid, body } = await verifyShopifyWebhook(request, env)
../functions/api/shopify/webhooks/customers-delete.ts:14:    request.headers.get('x-shopify-delivery-id') ||
../functions/api/shopify/webhooks/customers-delete.ts:15:    request.headers.get('x-shopify-webhook-id') ||
../functions/api/shopify/webhooks/customers-delete.ts:16:    request.headers.get('X-Shopify-Webhook-Id') ||
../functions/api/shopify/webhooks/customers-delete.ts:21:    request.headers.get('x-shopify-shop-domain') ||
../functions/api/shopify/webhooks/customers-delete.ts:22:    request.headers.get('X-Shopify-Shop-Domain') ||
../api/_lib/orders.ts:26:  // Map Shopify status to internal OrderStatus
../api/_lib/orders.ts:48:    events: JSON.stringify([{ at: new Date().toISOString(), message: 'Order synced from Shopify' }]),
../functions/api/shopify/webhooks/customers-create.ts:3:import { verifyShopifyWebhook } from '../../../_lib/shopifyWebhooks'
../functions/api/shopify/webhooks/customers-create.ts:10:  const { valid, body } = await verifyShopifyWebhook(request, env)
../functions/api/shopify/webhooks/customers-create.ts:14:    request.headers.get('x-shopify-delivery-id') ||
../functions/api/shopify/webhooks/customers-create.ts:15:    request.headers.get('x-shopify-webhook-id') ||
../functions/api/shopify/webhooks/customers-create.ts:16:    request.headers.get('X-Shopify-Webhook-Id') ||
../functions/api/shopify/webhooks/customers-create.ts:21:    request.headers.get('x-shopify-shop-domain') ||
../functions/api/shopify/webhooks/customers-create.ts:22:    request.headers.get('X-Shopify-Shop-Domain') ||
../api/_lib/README.md:2:Express webhook/dev server for local integration tests (Shopify/Clerk/Supabase). Not shipped to the client bundle. Keep API logic domain-agnostic; per-domain handlers should live with the domain and be imported here.
../functions/api/shopify/auth/callback.ts:4:import { verifyShopifyHmac } from '../../../_lib/shopifyOAuth'
../functions/api/shopify/auth/callback.ts:17:  if (state !== getCookie(request, 'shopify_state')) return text('Invalid state', { status: 401 })
../functions/api/shopify/auth/callback.ts:19:  const ok = await verifyShopifyHmac(env, url)
../functions/api/shopify/auth/callback.ts:26:      client_id: env.SHOPIFY_API_KEY,
../functions/api/shopify/auth/callback.ts:27:      client_secret: env.SHOPIFY_API_SECRET,
../functions/api/shopify/auth/callback.ts:51:  const webhookUrlBase = env.SHOPIFY_APP_URL || url.origin
../functions/api/shopify/auth/callback.ts:52:  const version = env.SHOPIFY_API_VERSION || '2025-10'
../functions/api/shopify/auth/callback.ts:63:      headers: { 'content-type': 'application/json', 'X-Shopify-Access-Token': tokenJson.access_token },
../functions/api/shopify/auth/callback.ts:69:    await createWebhook('CUSTOMERS_CREATE', '/api/shopify/webhooks/customers-create')
../functions/api/shopify/auth/callback.ts:70:    await createWebhook('CUSTOMERS_UPDATE', '/api/shopify/webhooks/customers-update')
../functions/api/shopify/auth/callback.ts:71:    await createWebhook('CUSTOMERS_DELETE', '/api/shopify/webhooks/customers-delete')
../functions/api/shopify/auth/callback.ts:72:    await createWebhook('APP_UNINSTALLED', '/api/shopify/webhooks/app-uninstalled')
../functions/api/shopify/auth/callback.ts:73:    await createWebhook('ORDERS_CREATE', '/api/shopify/webhooks/orders-create')
../functions/api/shopify/auth/callback.ts:74:    await createWebhook('ORDERS_UPDATED', '/api/shopify/webhooks/orders-updated')
../functions/api/shopify/auth/callback.ts:75:    await createWebhook('FULFILLMENTS_CREATE', '/api/shopify/webhooks/fulfillments-create')
../functions/api/shopify/auth/callback.ts:82:    'shopify_state=; Path=/; HttpOnly; Secure; SameSite=None; Max-Age=0',
../functions/api/shopify/auth/callback.ts:83:    'shopify_shop=; Path=/; HttpOnly; Secure; SameSite=None; Max-Age=0',
../functions/api/shopify/auth/callback.ts:87:  headers.set('Location', `/shopify/app${hostPath}`)
../api/_lib/customers.ts:26:  // Handle both Shopify (numeric) and Clerk (string) IDs
../functions/api/customer-auth/start.ts:10:  const shop = (url.searchParams.get('shop') || env.SHOPIFY_STORE_DOMAIN || '').trim()
../api/shopify/sync.ts:2:import { handleSyncForShop } from "../_lib/shopifyCore.js";
../api/shopify/auth.ts:6:  return /^(?:[a-z0-9][a-z0-9-]*)\.myshopify\.com$/i.test(shop);
../api/shopify/auth.ts:17:  const apiKey = process.env.SHOPIFY_API_KEY;
../api/shopify/auth.ts:18:  const scopes = process.env.SCOPES || process.env.SHOPIFY_SCOPES || "read_products,write_products";
../api/shopify/auth.ts:19:  const appUrl = process.env.SHOPIFY_APP_URL || url.origin;
../api/shopify/auth.ts:20:  const callback = new URL("/api/shopify/auth/callback", appUrl).toString();
../api/shopify/auth.ts:34:    `shopify_state=${state}; Path=/; HttpOnly; Secure; SameSite=None; Max-Age=600`,
../api/shopify/auth.ts:38:    `shopify_shop=${shop}; Path=/; HttpOnly; Secure; SameSite=None; Max-Age=600`,
../api/shopify/billing/create.ts:1:import { ensureShopifySessionTable, getPgPool } from "../../_lib/db.js";
../api/shopify/billing/create.ts:3:const API_VERSION = process.env.SHOPIFY_API_VERSION || "2025-01";
../api/shopify/billing/create.ts:12:  await ensureShopifySessionTable()
../api/shopify/billing/create.ts:21:  const returnUrl = new URL("/shopify/app", url.origin);
../api/shopify/billing/create.ts:29:      "X-Shopify-Access-Token": token,
../api/storefront/cart/restore.ts:16:  // TODO: fetch/create Shopify cart and replay lines/discounts/email
../api/shopify/webhooks/customers-data-request.ts:11:  const shop = (req.headers['x-shopify-shop-domain'] || body?.domain || body?.shop_domain) as string
../functions/cart/c/[[catchall]].ts:2:import { proxyShopifyCheckout } from '../../_lib/shopifyCheckoutProxy'
../functions/cart/c/[[catchall]].ts:4:export const onRequest: PagesFunction = (context) => proxyShopifyCheckout(context as any)
../api/shopify/webhooks/checkouts-create.ts:17:    console.log('Received Shopify Checkout Create Webhook')
../api/storefront/_client.ts:1:const API_VERSION = process.env.SHOPIFY_API_VERSION || '2025-10'
../api/storefront/_client.ts:2:const DOMAIN = process.env.SHOPIFY_STORE_DOMAIN
../api/storefront/_client.ts:3:const PRIVATE_TOKEN = process.env.SHOPIFY_STOREFRONT_PRIVATE_TOKEN
../api/storefront/_client.ts:15:      'X-Shopify-Storefront-Private-Token': PRIVATE_TOKEN as string,
../api/shopify/webhooks/fulfillments-create.ts:41:  const deliveryId = (req.headers['x-shopify-delivery-id'] || '') as string
../api/shopify/webhooks/fulfillments-create.ts:43:  const shop = (req.headers['x-shopify-shop-domain'] || body?.domain || body?.shop_domain) as string
../api/shopify/webhooks/fulfillments-create.ts:105:          [userId, order?.email ?? attrs.lumelle_user_email ?? null, JSON.stringify({ source: 'shopify_webhook' })],
../api/shopify/webhooks/fulfillments-create.ts:113:            `shopify:fulfillment:${shop}:${orderId}`,
../api/shopify/webhooks/fulfillments-create.ts:120:              shopify_delivery_id: deliveryId || null,
../api/shopify/webhooks/fulfillments-create.ts:130:    // Let Shopify retry if needed (awardKey is idempotent, and deliveryId is already marked)
../api/shopify/webhooks/checkouts-update.ts:17:    console.log('Received Shopify Checkout Update Webhook')
../api/shopify/webhooks/_verify.ts:4:export async function verifyWebhook(req: VercelRequest, secret = process.env.SHOPIFY_WEBHOOK_SECRET || process.env.SHOPIFY_API_SECRET || "") {
../api/shopify/webhooks/_verify.ts:5:  const hmacHeader = (req.headers["x-shopify-hmac-sha256"] || "") as string;
../api/shopify/webhooks/orders-create.ts:27:  const deliveryId = (req.headers['x-shopify-delivery-id'] || '') as string
../api/shopify/webhooks/orders-create.ts:29:  const shop = (req.headers['x-shopify-shop-domain'] || body?.shop_domain || body?.domain) as string
../api/shopify/webhooks/orders-create.ts:47:          source: 'shopify_webhook',
../api/shopify/webhooks/orders-create.ts:50:          shopify_delivery_id: deliveryId || undefined,
../api/shopify/webhooks/app-uninstalled.ts:2:import { handleAppUninstalled } from "../../_lib/shopifyCore.js";
../api/shopify/webhooks/app-uninstalled.ts:12:  const shop = (req.headers['x-shopify-shop-domain'] || body?.domain || body?.shop_domain || body?.shop) as string
../functions/api/admin/sections/update.ts:4:import { adminGraphQL, getAdminToken } from '../../../_lib/shopifyAdmin'
../functions/api/admin/sections/update.ts:14:  const shop = url.searchParams.get('shop') || env.SHOPIFY_STORE_DOMAIN || ''
../api/shopify/webhooks/customers-redact.ts:11:  const shop = (req.headers['x-shopify-shop-domain'] || body?.domain || body?.shop_domain) as string
../api/shopify/webhooks/shop-redact.ts:11:  const shop = (req.headers['x-shopify-shop-domain'] || body?.domain || body?.shop_domain) as string
../api/customer-auth/start.ts:8:  const shop = (url.searchParams.get('shop') || process.env.SHOPIFY_STORE_DOMAIN || '').trim()
../api/shopify/webhooks/products_create.ts:16:    // const hmac = req.headers.get("X-Shopify-Hmac-Sha256"); // No longer needed directly here
../api/shopify/webhooks/products_create.ts:17:    const secret = process.env.SHOPIFY_API_SECRET;
../api/shopify/webhooks/products_create.ts:20:        console.error("SHOPIFY_API_SECRET is not set");
../api/shopify/webhooks/products_create.ts:29:    const topic = (req.headers['x-shopify-topic'] || '') as string;
../api/shopify/webhooks/products_create.ts:30:    const shop = (req.headers['x-shopify-shop-domain'] || body?.domain || body?.shop_domain) as string;
../api/shopify/webhooks/products_create.ts:38:    // Map Shopify product to our schema
../api/shopify/webhooks/products_create.ts:39:    // id is uuid in our DB, but Shopify ID is a number (e.g. 123456789)
../api/shopify/webhooks/products_create.ts:40:    // We might need to store Shopify ID in a separate column or use a deterministic UUID based on Shopify ID
../api/shopify/webhooks/products_create.ts:41:    // For now, let's assume we check if a product with this SKU exists, or we need to add a shopify_id column to products table.
../api/shopify/webhooks/products_create.ts:43:    // It doesn't have shopify_id.
../functions/api/admin/sections/get.ts:4:import { adminGraphQL, getAdminToken } from '../../../_lib/shopifyAdmin'
../functions/api/admin/sections/get.ts:14:  const shop = url.searchParams.get('shop') || env.SHOPIFY_STORE_DOMAIN || ''
../api/customer-auth/utils.ts:3:  const ca = await fetch(`https://${shop}/.well-known/shopify/customer-account-api/unstable`).then(r => r.json())
../api/shopify/webhooks/orders-updated.ts:42:  const deliveryId = (req.headers['x-shopify-delivery-id'] || '') as string
../api/shopify/webhooks/orders-updated.ts:50:  const shop = (req.headers['x-shopify-shop-domain'] || body?.shop_domain || body?.domain) as string
../api/shopify/webhooks/orders-updated.ts:92:            [userId, order?.email ?? attrs.lumelle_user_email ?? null, JSON.stringify({ source: 'shopify_webhook' })],
../api/shopify/webhooks/orders-updated.ts:95:          const awardSource = `shopify:fulfillment:${shop}:${orderId}`
../api/shopify/webhooks/orders-updated.ts:110:                `shopify:refund:${shop}:${orderId}`,
../api/shopify/webhooks/orders-updated.ts:127:      // Let Shopify retry (deliveryId is already marked)
../api/shopify/webhooks/customers-update.ts:11:  const deliveryId = (req.headers['x-shopify-delivery-id'] || '') as string;
../api/shopify/webhooks/customers-update.ts:14:  const shop = (req.headers['x-shopify-shop-domain'] || body?.domain || body?.shop_domain) as string;
../api/shopify/_lib/verify.ts:4:  const secret = process.env.SHOPIFY_API_SECRET
../api/shopify/_lib/verify.ts:6:    throw new Error('SHOPIFY_API_SECRET is not set')
../api/shopify/webhooks/customers-delete.ts:12:  const deliveryId = (req.headers['x-shopify-delivery-id'] || '') as string
../api/shopify/webhooks/customers-delete.ts:14:  const shop = (req.headers['x-shopify-shop-domain'] || body?.domain || body?.shop_domain) as string
../api/shopify/webhooks/customers-create.ts:13:  const deliveryId = (req.headers['x-shopify-delivery-id'] || '') as string
../api/shopify/webhooks/customers-create.ts:16:  const shop = (req.headers['x-shopify-shop-domain'] || body?.domain || body?.shop_domain) as string
../api/shopify/session.ts:1:import { ensureShopifySessionTable, getPgPool } from "../_lib/db.js";
../api/shopify/session.ts:8:  await ensureShopifySessionTable()
../api/shopify/_admin.ts:1:import { ensureShopifySessionTable, getPgPool } from "../_lib/db.js";
../api/shopify/_admin.ts:4:  await ensureShopifySessionTable()
../api/shopify/_admin.ts:15:  const version = process.env.SHOPIFY_API_VERSION || "2025-10";
../api/shopify/_admin.ts:20:      "X-Shopify-Access-Token": token,
../api/shopify/auth/callback.ts:4:import { ensureShopifySessionTable, getPgPool } from "../../_lib/db.js";
../api/shopify/auth/callback.ts:27:  if (!cookies["shopify_state"] || cookies["shopify_state"] !== state) return bad(res, 401, "Invalid state");
../api/shopify/auth/callback.ts:31:  const expected = signHmac(message, process.env.SHOPIFY_API_SECRET || "");
../api/shopify/auth/callback.ts:39:      client_id: process.env.SHOPIFY_API_KEY,
../api/shopify/auth/callback.ts:40:      client_secret: process.env.SHOPIFY_API_SECRET,
../api/shopify/auth/callback.ts:49:  await ensureShopifySessionTable()
../api/shopify/auth/callback.ts:59:    await fetch(`https://${shop}/admin/api/${process.env.SHOPIFY_API_VERSION || '2025-10'}/graphql.json`, {
../api/shopify/auth/callback.ts:63:        'X-Shopify-Access-Token': tokenJson.access_token,
../api/shopify/auth/callback.ts:71:    await createWebhook('CUSTOMERS_CREATE', '/api/shopify/webhooks/customers-create');
../api/shopify/auth/callback.ts:72:    await createWebhook('CUSTOMERS_UPDATE', '/api/shopify/webhooks/customers-update');
../api/shopify/auth/callback.ts:73:    await createWebhook('CUSTOMERS_DELETE', '/api/shopify/webhooks/customers-delete');
../api/shopify/auth/callback.ts:74:    await createWebhook('APP_UNINSTALLED', '/api/shopify/webhooks/app-uninstalled');
../api/shopify/auth/callback.ts:75:    await createWebhook('ORDERS_CREATE', '/api/shopify/webhooks/orders-create');
../api/shopify/auth/callback.ts:76:    await createWebhook('ORDERS_UPDATED', '/api/shopify/webhooks/orders-updated');
../api/shopify/auth/callback.ts:77:    await createWebhook('FULFILLMENTS_CREATE', '/api/shopify/webhooks/fulfillments-create');
../api/shopify/auth/callback.ts:84:    "shopify_state=; Path=/; HttpOnly; Secure; SameSite=None; Max-Age=0",
../api/shopify/auth/callback.ts:85:    "shopify_shop=; Path=/; HttpOnly; Secure; SameSite=None; Max-Age=0",
../api/shopify/auth/callback.ts:87:  res.setHeader('Location', `/shopify/app${hostPath}`)
../api/shopify/ping.ts:2:import { handlePing } from "../_lib/shopifyCore.js";
../api/admin/sections/get.ts:1:import { getAdminToken, adminGraphQL } from "../../shopify/_admin.js";
../api/admin/sections/get.ts:9:  const shop = url.searchParams.get('shop') || process.env.SHOPIFY_STORE_DOMAIN || ''
../api/admin/sections/update.ts:1:import { getAdminToken, adminGraphQL } from "../../shopify/_admin.js";
../api/admin/sections/update.ts:9:  const shop = url.searchParams.get('shop') || process.env.SHOPIFY_STORE_DOMAIN || ''
../functions/_lib/shopifyCheckoutProxy.ts:8:    (env.SHOPIFY_CHECKOUT_UPSTREAM_DOMAIN as string | undefined) ||
../functions/_lib/shopifyCheckoutProxy.ts:9:    (env.SHOPIFY_STORE_DOMAIN as string | undefined) ||
../functions/_lib/shopifyCheckoutProxy.ts:10:    (env.VITE_SHOPIFY_STORE_DOMAIN as string | undefined)
../functions/_lib/shopifyCheckoutProxy.ts:55:          You’re on a Shopify checkout/cart link:
../functions/_lib/shopifyCheckoutProxy.ts:61:          This site is hosted as a headless app on <code>${escapeHtml(currentHost)}</code>, but Shopify is currently issuing checkout URLs on that same host.
../functions/_lib/shopifyCheckoutProxy.ts:62:          To make a proxy work, Shopify must serve checkout pages from an upstream domain (usually <code>…myshopify.com</code>) that does <em>not</em> redirect back here.
../functions/_lib/shopifyCheckoutProxy.ts:66:          Fix: In Shopify Admin → <strong>Settings → Domains</strong>, set the store’s <strong>primary domain</strong> to <code>${upstream}</code>
../functions/_lib/shopifyCheckoutProxy.ts:67:          (or to a dedicated Shopify subdomain like <code>shop.${escapeHtml(currentHost)}</code>), then try again.
../functions/_lib/shopifyCheckoutProxy.ts:100:export async function proxyShopifyCheckout(context: PagesContext<Env & Record<string, unknown>>): Promise<Response> {
../functions/_lib/shopifyCheckoutProxy.ts:127:        reason: 'Missing SHOPIFY_CHECKOUT_UPSTREAM_DOMAIN / SHOPIFY_STORE_DOMAIN in Pages environment variables.',
../functions/_lib/shopifyCheckoutProxy.ts:159:  // If Shopify is redirecting back to the current host, the proxy cannot complete until Shopify domains are adjusted.
../functions/_lib/shopifyCheckoutProxy.ts:171:            reason: `Shopify redirected upstream checkout request back to ${currentHost} (${redirectReason}).`,
../functions/_lib/shopifyAdmin.ts:6:  // This avoids having to run the Shopify OAuth install flow just to read/write admin metafields.
../functions/_lib/shopifyAdmin.ts:7:  if (env.SHOPIFY_ADMIN_API_ACCESS_TOKEN) return env.SHOPIFY_ADMIN_API_ACCESS_TOKEN
../functions/_lib/shopifyAdmin.ts:24:  const version = env.SHOPIFY_API_VERSION || '2025-10'
../functions/_lib/shopifyAdmin.ts:29:      'X-Shopify-Access-Token': token,
../functions/_lib/shopifyOAuth.ts:6:  return /^(?:[a-z0-9][a-z0-9-]*)\\.myshopify\\.com$/i.test(shop)
../functions/_lib/shopifyOAuth.ts:17:export async function verifyShopifyHmac(env: Env, url: URL) {
../functions/_lib/shopifyOAuth.ts:18:  const secret = env.SHOPIFY_API_SECRET || ''
../functions/_lib/shopifyOAuth.ts:19:  if (!secret) throw new Error('SHOPIFY_API_SECRET is not set')
../functions/checkouts/[[catchall]].ts:3:import { proxyShopifyCheckout } from '../_lib/shopifyCheckoutProxy'
../functions/checkouts/[[catchall]].ts:5:export const onRequest: PagesFunction = (context) => proxyShopifyCheckout(context as any)
../functions/_lib/types.ts:6:  // PostHog (server-side capture, e.g. Shopify webhooks → purchase)
../functions/_lib/types.ts:22:  // Shopify (app + webhooks)
../functions/_lib/types.ts:23:  SHOPIFY_STORE_DOMAIN?: string
../functions/_lib/types.ts:25:  VITE_SHOPIFY_STORE_DOMAIN?: string
../functions/_lib/types.ts:26:  // Optional: explicitly choose the upstream host for checkout proxying (e.g. myshopify.com).
../functions/_lib/types.ts:27:  // If omitted, falls back to SHOPIFY_STORE_DOMAIN / VITE_SHOPIFY_STORE_DOMAIN.
../functions/_lib/types.ts:28:  SHOPIFY_CHECKOUT_UPSTREAM_DOMAIN?: string
../functions/_lib/types.ts:29:  SHOPIFY_API_KEY?: string
../functions/_lib/types.ts:30:  SHOPIFY_API_SECRET?: string
../functions/_lib/types.ts:31:  SHOPIFY_ADMIN_API_ACCESS_TOKEN?: string
../functions/_lib/types.ts:32:  SHOPIFY_API_VERSION?: string
../functions/_lib/types.ts:33:  SHOPIFY_SCOPES?: string
../functions/_lib/types.ts:35:  SHOPIFY_APP_URL?: string
../functions/_lib/types.ts:36:  SHOPIFY_WEBHOOK_SECRET?: string
../functions/_lib/types.ts:38:  // Shopify Storefront (private token used server-side)
../functions/_lib/types.ts:39:  SHOPIFY_STOREFRONT_PRIVATE_TOKEN?: string
../functions/_lib/types.ts:41:  // Shopify Customer Accounts
../functions/_lib/types.ts:54:  // Loyalty (optional; used by Shopify webhooks)
../functions/_lib/customerAccounts.ts:20:    fetch(`https://${shop}/.well-known/shopify/customer-account-api/unstable`).then((r) => r.json()),
../functions/api/storefront/landing/sections.ts:49:    schemaVersion: 'shopify.metaobjects.v1',
../functions/_lib/storefront.ts:4:  const version = env.SHOPIFY_API_VERSION || '2025-10'
../functions/_lib/storefront.ts:5:  const domain = env.SHOPIFY_STORE_DOMAIN
../functions/_lib/storefront.ts:6:  const privateToken = env.SHOPIFY_STOREFRONT_PRIVATE_TOKEN
../functions/_lib/storefront.ts:8:    throw new Error('Storefront private token or domain not set (SHOPIFY_STORE_DOMAIN/SHOPIFY_STOREFRONT_PRIVATE_TOKEN)')
../functions/_lib/storefront.ts:19:      'X-Shopify-Storefront-Private-Token': privateToken,
../functions/_lib/shopifyWebhooks.ts:4:export async function verifyShopifyWebhook(
../functions/_lib/shopifyWebhooks.ts:8:  const hmacHeader = request.headers.get('x-shopify-hmac-sha256') || request.headers.get('X-Shopify-Hmac-Sha256')
../functions/_lib/shopifyWebhooks.ts:11:  // Shopify signs webhook payloads with the app secret (`SHOPIFY_API_SECRET`).
../functions/_lib/shopifyWebhooks.ts:12:  // Some deployments historically used a separate env var name (`SHOPIFY_WEBHOOK_SECRET`) which
../functions/_lib/shopifyWebhooks.ts:14:  const apiSecret = env.SHOPIFY_API_SECRET || ''
../functions/_lib/shopifyWebhooks.ts:15:  const webhookSecret = env.SHOPIFY_WEBHOOK_SECRET || ''
../src/domains/client/shop/cart/logic/volumeDiscounts.ts:15:// Public discount codes (configured in Shopify admin).
../src/domains/client/shop/cart/providers/CartContext.tsx:93:const isLegacyShopifyGid = (id: string) => id.startsWith('gid://shopify/')
../src/domains/client/shop/cart/providers/CartContext.tsx:95:const clearLegacyShopifyCartId = () => {
../src/domains/client/shop/cart/providers/CartContext.tsx:97:    localStorage.removeItem('lumelle_shopify_cart_id')
../src/domains/client/shop/cart/providers/CartContext.tsx:252:    clearLegacyShopifyCartId()
../src/domains/client/shop/cart/providers/CartContext.tsx:255:      // Filter out legacy Shopify GIDs (pre-ports) to avoid feeding undecodable IDs into ports.
../src/domains/client/shop/cart/providers/CartContext.tsx:257:      const compatibleSeed = seedItems.filter((i) => !isLegacyShopifyGid(i.id))
../src/domains/admin/orders/ui/pages/OrdersPage.tsx:181:      subtitle="Prototype UI. Next: wire to Shopify (or Supabase mirror), then add search + actions."
../src/domains/admin/orders/ui/pages/OrdersPage.tsx:348:                  Actions (open in Shopify, refund, resend confirmation)
../src/domains/admin/settings/ui/pages/SettingsPage.tsx:19:            Integrations (Shopify, Supabase, email, analytics)
../src/domains/admin/pages/data/pages.ts:150:      { title: 'Vendors', body: 'Shopify, Supabase, Clerk, PostHog — DPIAs on file.' },
../src/domains/admin/pages/ui/pages/PagesPage.tsx:156:      { title: 'Vendors', body: 'Shopify, Supabase, Clerk, PostHog — DPIAs on file.' },
../src/domains/admin/pages/ui/pages/ContentPage.tsx:75:    <AdminPageLayout title="Product content" subtitle="Edit landing/PDP copy blocks (Shopify metafield-backed).">
../src/domains/client/shop/products/data/product-loaders.ts:42:  // Sections are currently stored as global Shopify metaobjects (hero/faq/how/etc).
../src/types/shopify-window.d.ts:3:    shopify: any;
../src/domains/platform/content/adapters/shopify/internal-api/sections.ts:4:export const createShopifyLandingSectionsPort = (): ContentPort => {
../src/domains/platform/content/adapters/shopify/internal-api/index.ts:2:import { createShopifyLandingSectionsPort } from './sections'
../src/domains/platform/content/adapters/shopify/internal-api/index.ts:4:export type ShopifyContentAdapter = {
../src/domains/platform/content/adapters/shopify/internal-api/index.ts:8:export const createShopifyContentAdapter = (): ShopifyContentAdapter => {
../src/domains/platform/content/adapters/shopify/internal-api/index.ts:9:  return { sections: createShopifyLandingSectionsPort() }
../src/domains/platform/content/runtime.ts:4:import { createShopifyContentAdapter } from './adapters/shopify/internal-api'
../src/domains/platform/content/runtime.ts:12:const isShopifyConfigured = () => {
../src/domains/platform/content/runtime.ts:13:  const domain = env('SHOPIFY_STORE_DOMAIN')
../src/domains/platform/content/runtime.ts:48:  const configured = isShopifyConfigured()
../src/domains/platform/content/runtime.ts:54:      'Content provider is not configured (missing SHOPIFY_STORE_DOMAIN).'
../src/domains/platform/content/runtime.ts:61:  const adapter = createShopifyContentAdapter()
../src/domains/platform/commerce/runtime.ts:4:import { createShopifyCommerceAdapter } from './adapters/shopify/internal-api'
../src/domains/platform/commerce/runtime.ts:14:const isShopifyConfigured = () => {
../src/domains/platform/commerce/runtime.ts:15:  const domain = env('SHOPIFY_STORE_DOMAIN')
../src/domains/platform/commerce/runtime.ts:126:  const configured = isShopifyConfigured()
../src/domains/platform/commerce/runtime.ts:132:      'Commerce provider is not configured (missing SHOPIFY_STORE_DOMAIN).'
../src/domains/platform/commerce/runtime.ts:139:  const adapter = createShopifyCommerceAdapter()
../src/domains/platform/commerce/adapters/shopify/internal-api/keys.ts:1:// Opaque key encoding to avoid leaking raw Shopify GIDs above the adapter boundary.
../src/domains/platform/commerce/adapters/shopify/internal-api/catalog.ts:5:type ShopifyMoney = { amount: string; currencyCode: string }
../src/domains/platform/commerce/adapters/shopify/internal-api/catalog.ts:6:type ShopifyProduct = {
../src/domains/platform/commerce/adapters/shopify/internal-api/catalog.ts:12:  variants?: { edges?: Array<{ node?: { id: string; title?: string | null; price?: ShopifyMoney } | null } | null> | null } | null
../src/domains/platform/commerce/adapters/shopify/internal-api/catalog.ts:15:export const createShopifyCatalogPort = (): CatalogPort => {
../src/domains/platform/commerce/adapters/shopify/internal-api/catalog.ts:18:      const data = await requestJson<{ product: ShopifyProduct | null }>(`/api/storefront/product/by-handle?handle=${encodeURIComponent(handle)}`)
../src/domains/platform/commerce/adapters/shopify/internal-api/checkout.ts:4:import { __internalShopifyCartKeyStorage } from './cart'
../src/domains/platform/commerce/adapters/shopify/internal-api/checkout.ts:6:type ShopifyCart = {
../src/domains/platform/commerce/adapters/shopify/internal-api/checkout.ts:20:export const createShopifyCheckoutPort = (): CheckoutPort => {
../src/domains/platform/commerce/adapters/shopify/internal-api/checkout.ts:33:      const stored = __internalShopifyCartKeyStorage.getStoredCartKey()
../src/domains/platform/commerce/adapters/shopify/internal-api/checkout.ts:37:      const data = await requestJson<{ cart: ShopifyCart }>(`/api/storefront/cart/fetch?id=${encodeURIComponent(rawCartId)}`)
../src/domains/platform/commerce/adapters/shopify/internal-api/keyRegistry.ts:5:// v1 stable keys (provider-independent) -> Shopify variant GIDs.
../src/domains/platform/commerce/adapters/shopify/internal-api/keyRegistry.ts:8:// code never needs to store or reason about Shopify identifiers.
../src/domains/platform/commerce/adapters/shopify/internal-api/keyRegistry.ts:11:const SHOPIFY_VARIANT_GID_BY_STABLE_VARIANT_KEY = {
../src/domains/platform/commerce/adapters/shopify/internal-api/keyRegistry.ts:12:  'variant.lumelle-shower-cap.default': 'gid://shopify/ProductVariant/56829020504438',
../src/domains/platform/commerce/adapters/shopify/internal-api/keyRegistry.ts:13:  'variant.satin-overnight-curler.default': 'gid://shopify/ProductVariant/56852779696502',
../src/domains/platform/commerce/adapters/shopify/internal-api/keyRegistry.ts:16:const stableVariantKeyFromShopifyGid = (gid: string): VariantKey | null => {
../src/domains/platform/commerce/adapters/shopify/internal-api/keyRegistry.ts:17:  for (const [key, value] of Object.entries(SHOPIFY_VARIANT_GID_BY_STABLE_VARIANT_KEY)) {
../src/domains/platform/commerce/adapters/shopify/internal-api/keyRegistry.ts:23:const isLegacyShopifyGid = (value: string) => value.startsWith('gid://shopify/')
../src/domains/platform/commerce/adapters/shopify/internal-api/keyRegistry.ts:32:export const toVariantKey = (shopifyVariantGid: string): VariantKey => {
../src/domains/platform/commerce/adapters/shopify/internal-api/keyRegistry.ts:33:  return stableVariantKeyFromShopifyGid(shopifyVariantGid) ?? encodeVariantKey(shopifyVariantGid)
../src/domains/platform/commerce/adapters/shopify/internal-api/keyRegistry.ts:36:export const resolveShopifyVariantGid = (variantKey: VariantKey): string => {
../src/domains/platform/commerce/adapters/shopify/internal-api/keyRegistry.ts:39:  if (isLegacyShopifyGid(variantKey)) return variantKey
../src/domains/platform/commerce/adapters/shopify/internal-api/keyRegistry.ts:43:  const gid = (SHOPIFY_VARIANT_GID_BY_STABLE_VARIANT_KEY as Record<string, string | undefined>)[variantKey]
../src/domains/platform/commerce/adapters/shopify/internal-api/keyRegistry.ts:46:  throw new PortError('NOT_FOUND', `No Shopify mapping found for variantKey: ${variantKey}`)
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:4:import { resolveShopifyVariantGid, toVariantKey } from './keyRegistry'
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:7:type ShopifyCartLine = {
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:19:type ShopifyCart = {
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:22:  lines?: { edges?: Array<{ node: ShopifyCartLine }> } | null
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:43:const mapCart = (cart: ShopifyCart): CartDTO => {
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:75:export const createShopifyCartPort = (): CartPort => {
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:80:    const created = await requestJson<{ cart: ShopifyCart }>(`/api/storefront/cart/create`, { method: 'POST', body: {} })
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:86:  const fetchCart = async (rawCartId: string): Promise<ShopifyCart> => {
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:87:    const data = await requestJson<{ cart: ShopifyCart }>(`/api/storefront/cart/fetch?id=${encodeURIComponent(rawCartId)}`)
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:91:  const updateStoredKey = (cart: ShopifyCart) => setStoredCartKey(encodeCartKey(cart.id))
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:105:      const created = await requestJson<{ cart: ShopifyCart }>(`/api/storefront/cart/create`, {
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:107:        body: { merchandiseId: resolveShopifyVariantGid(first.variantKey), quantity: first.qty },
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:112:        const next = await requestJson<{ cart: ShopifyCart }>(`/api/storefront/cart/add-lines`, {
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:114:          body: { cartId: cart.id, merchandiseId: resolveShopifyVariantGid(line.variantKey), quantity: line.qty },
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:120:        const next = await requestJson<{ cart: ShopifyCart }>(`/api/storefront/cart/discount-codes-update`, {
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:129:        const next = await requestJson<{ cart: ShopifyCart }>(`/api/storefront/cart/attributes-update`, {
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:137:        const next = await requestJson<{ cart: ShopifyCart }>(`/api/storefront/cart/set-buyer-identity`, {
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:151:        const created = await requestJson<{ cart: ShopifyCart }>(`/api/storefront/cart/create`, {
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:153:          body: { merchandiseId: resolveShopifyVariantGid(variantKey), quantity: qty },
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:160:      const updated = await requestJson<{ cart: ShopifyCart }>(`/api/storefront/cart/add-lines`, {
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:162:        body: { cartId: rawCartId, merchandiseId: resolveShopifyVariantGid(variantKey), quantity: qty },
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:172:      const updated = await requestJson<{ cart: ShopifyCart }>(`/api/storefront/cart/update-line`, {
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:184:      const updated = await requestJson<{ cart: ShopifyCart }>(`/api/storefront/cart/remove-lines`, {
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:194:      const updated = await requestJson<{ cart: ShopifyCart }>(`/api/storefront/cart/discount-codes-update`, {
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:204:      const updated = await requestJson<{ cart: ShopifyCart }>(`/api/storefront/cart/set-buyer-identity`, {
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:215:      const updated = await requestJson<{ cart: ShopifyCart }>(`/api/storefront/cart/attributes-update`, {
../src/domains/platform/commerce/adapters/shopify/internal-api/cart.ts:225:export const __internalShopifyCartKeyStorage = {
../src/domains/platform/commerce/adapters/shopify/internal-api/index.ts:2:import { createShopifyCatalogPort } from './catalog'
../src/domains/platform/commerce/adapters/shopify/internal-api/index.ts:3:import { createShopifyCartPort } from './cart'
../src/domains/platform/commerce/adapters/shopify/internal-api/index.ts:4:import { createShopifyCheckoutPort } from './checkout'
../src/domains/platform/commerce/adapters/shopify/internal-api/index.ts:6:export type ShopifyCommerceAdapter = {
../src/domains/platform/commerce/adapters/shopify/internal-api/index.ts:12:export const createShopifyCommerceAdapter = (): ShopifyCommerceAdapter => {
../src/domains/platform/commerce/adapters/shopify/internal-api/index.ts:13:  const cart = createShopifyCartPort()
../src/domains/platform/commerce/adapters/shopify/internal-api/index.ts:14:  const checkout = createShopifyCheckoutPort()
../src/domains/platform/commerce/adapters/shopify/internal-api/index.ts:15:  const catalog = createShopifyCatalogPort()
../src/domains/client/shop/cart/ui/pages/CheckoutHandoffPage.tsx:11:  const shopifyStoreDomain = env('SHOPIFY_STORE_DOMAIN')
../src/domains/client/shop/cart/ui/pages/CheckoutHandoffPage.tsx:24:  const shopifyCheckoutUrl = useMemo(() => {
../src/domains/client/shop/cart/ui/pages/CheckoutHandoffPage.tsx:25:    const raw = (shopifyStoreDomain ?? '').trim()
../src/domains/client/shop/cart/ui/pages/CheckoutHandoffPage.tsx:34:  }, [fullPath, shopifyStoreDomain])
../src/domains/client/shop/cart/ui/pages/CheckoutHandoffPage.tsx:60:            {shopifyCheckoutUrl ? (
../src/domains/client/shop/cart/ui/pages/CheckoutHandoffPage.tsx:62:                href={shopifyCheckoutUrl}
../src/domains/client/shop/cart/ui/pages/CheckoutHandoffPage.tsx:83:                  Shopify’s Storefront API returns cart checkout URLs on the shop’s <em>primary domain</em>. If Shopify’s primary domain is set to this same host
../src/domains/client/shop/cart/ui/pages/CheckoutHandoffPage.tsx:84:                  while the headless app is deployed here, checkout URLs resolve back into the SPA instead of Shopify.
../src/domains/client/shop/cart/ui/pages/CheckoutHandoffPage.tsx:94:                      Configured Shopify API domain:{' '}
../src/domains/client/shop/cart/ui/pages/CheckoutHandoffPage.tsx:95:                      <span className="font-mono text-[12px]">{shopifyStoreDomain ?? '(not set)'}</span>
../src/domains/client/shop/cart/ui/pages/CheckoutHandoffPage.tsx:104:                      In Shopify Admin → <span className="font-medium">Settings → Domains</span>, change the <span className="font-medium">primary domain</span> to a
../src/domains/client/shop/cart/ui/pages/CheckoutHandoffPage.tsx:105:                      Shopify-served domain (recommended: a subdomain like <span className="font-mono text-[12px]">shop.yourdomain.com</span>), and point that
../src/domains/client/shop/cart/ui/pages/CheckoutHandoffPage.tsx:106:                      subdomain’s DNS to Shopify.
../src/domains/client/shop/cart/ui/pages/CheckoutHandoffPage.tsx:109:                      If you must keep Shopify’s primary domain as-is, proxy Shopify checkout routes (at minimum <span className="font-mono text-[12px]">/cart/c/*</span>{' '}
../src/domains/client/shop/cart/ui/pages/CheckoutHandoffPage.tsx:110:                      and likely <span className="font-mono text-[12px]">/checkouts/*</span>) to Shopify at the edge (Cloudflare/Workers).
