../plan-route-repair.md:34:19. Restore real `src/lib/seo.ts` (setMetaTags, injectJsonLd, setNoIndex/NoFollow) and `src/lib/supabase.ts` implementations.
../plan-route-repair.md:41:24. Restore auth pages/providers; ensure `useSyncUserToSupabase` points to real implementation.
../vercel.json:7:    "VITE_ASSET_BASE_URL": "https://tmsbyiwqzesmirbargxv.supabase.co/storage/v1/object/public/public"
../src/lib/supabase.ts:1:export { createSupabaseClient, isSupabaseConfigured, supabase } from '@platform/storage/supabase'
../legacy/vercel-api/api/_lib/README.md:2:Express webhook/dev server for local integration tests (Shopify/Clerk/Supabase). Not shipped to the client bundle. Keep API logic domain-agnostic; per-domain handlers should live with the domain and be imported here.
../src/lib/utils/cdn.ts:16:  // TEMP: The Supabase CDN bucket is missing the shower-cap spotlight image,
../legacy/vercel-api/api/internal/recovery-cron.ts:5:  // TODO: hook into Supabase + Resend; for now, return not implemented.
../docs/05-planning/strategy/gemini/extended_roi_features.md:55:*   Use Vercel Analytics or a simple `web-vitals` library hook sending data to Supabase.
../docs/05-planning/strategy/gemini/server_architecture_plan.md:15:‚îÇ   ‚îú‚îÄ‚îÄ db.ts                 # Supabase Admin Client
../docs/05-planning/strategy/gemini/server_architecture_plan.md:48:import { supabase } from '../_lib/db';
../docs/05-planning/strategy/gemini/server_architecture_plan.md:56:    const { data: order, error } = await supabase
../src/hooks/useSyncUserToSupabase.ts:3:import { createSupabaseClient, supabase } from '@platform/storage/supabase'
../src/hooks/useSyncUserToSupabase.ts:20:export const useSyncUserToSupabase = () => {
../src/hooks/useSyncUserToSupabase.ts:47:      const token = await getToken({ template: 'supabase' }).catch(() => null)
../src/hooks/useSyncUserToSupabase.ts:48:      const client = token ? createSupabaseClient(token) : supabase
../src/hooks/useSyncUserToSupabase.ts:52:        console.error('Failed to sync Clerk user to Supabase', error)
../docs/05-planning/strategy/gemini/domain_structure_visual.md:39:‚îú‚îÄ‚îÄ lib/                         # üõ†Ô∏è Shared Utilities (Supabase, Helpers)
../legacy/vercel-api/api/storefront/cart/share.ts:14:  // TODO: store snapshot or cartId ref in Supabase/R2 and use snapshotRef instead of inline snapshot.
../.env.example:24:# Supabase (browser, safe-to-expose anon key)
../.env.example:25:VITE_SUPABASE_URL=
../.env.example:26:VITE_SUPABASE_ANON_KEY=
../.env.example:96:# Supabase (server-side)
../.env.example:97:SUPABASE_URL=
../.env.example:98:SUPABASE_SERVICE_ROLE_KEY=
../functions/api/orders/by-name.ts:2:import { getSupabase } from '../../_lib/supabase'
../functions/api/orders/by-name.ts:14:  const supabase = getSupabase(env)
../functions/api/orders/by-name.ts:15:  const { data, error } = await supabase.from('ShopOrders').select('*').eq('name', name).limit(1)
../functions/api/orders/by-email.ts:2:import { getSupabase } from '../../_lib/supabase'
../functions/api/orders/by-email.ts:13:  const supabase = getSupabase(env)
../functions/api/orders/by-email.ts:14:  const { data, error } = await supabase
../functions/api/orders/get.ts:2:import { getSupabase } from '../../_lib/supabase'
../functions/api/orders/get.ts:13:  const supabase = getSupabase(env)
../functions/api/orders/get.ts:14:  const { data, error } = await supabase.from('ShopOrders').select('*').eq('order_id', id).limit(1)
../functions/api/experiment/config.ts:2:import { getSupabase } from '../../_lib/supabase'
../functions/api/experiment/config.ts:8:  const supabase = getSupabase(env)
../functions/api/experiment/config.ts:9:  const { data, error } = await supabase
../functions/api/experiment/track.ts:2:import { getSupabase } from '../../_lib/supabase'
../functions/api/experiment/track.ts:40:  const supabase = getSupabase(env)
../functions/api/experiment/track.ts:43:    const { error } = await supabase.from('experiment_exposures').insert(exposures)
../functions/api/experiment/track.ts:48:    const { error } = await supabase.from('events').insert(events)
../docs/05-planning/future-features/A-B testing components/current-ui-measurement.md:21:## Storage mapping (Supabase `events` table)
../functions/api/exports/orders.ts:2:import { getSupabase } from '../../_lib/supabase'
../functions/api/exports/orders.ts:33:  const supabase = getSupabase(env)
../functions/api/exports/orders.ts:34:  const { data, error } = await supabase
../docs/05-planning/future-features/A-B testing components/dashboard-template.md:5:This file exists for the cases where we keep a SQL‚Äëqueryable audit trail in a database (Supabase or otherwise) and want Metabase/notebook cards.
../functions/api/exports/customers.ts:2:import { getSupabase } from '../../_lib/supabase'
../functions/api/exports/customers.ts:21:  const supabase = getSupabase(env)
../functions/api/exports/customers.ts:22:  const { data, error } = await supabase
../docs/05-planning/future-features/admin-content-self-service.md:4:Assumption (Dec 11 2025): media will live in Supabase Storage; keep this fixed unless requirements change.
../docs/05-planning/future-features/admin-content-self-service.md:16:     c) A lean bespoke admin we build on Supabase (DB + Storage) with our own content schemas and preview endpoints.  
../docs/05-planning/future-features/admin-content-self-service.md:17:   - Criteria: roles & workflows, media library UX, rich-text safety, localization, webhooks, preview API, rate limits, pricing, and how well each option works with Supabase Storage (fixed choice).
../docs/05-planning/future-features/A-B testing components/client-stub.md:76:Otherwise, analytics tables will bloat quickly (especially on the Supabase free tier).
../docs/05-planning/future-features/admin content self-service/research-checklist.md:6:- [ ] Define content models + types in Supabase (tables/views) and align IDs with frontend components.
../docs/05-planning/future-features/admin content self-service/research-checklist.md:8:- [ ] Image pipeline on Supabase Storage: upload limits, formats, auto WebP/AVIF, focal point, cropping presets, responsive renditions.
../docs/05-planning/future-features/admin content self-service/research-checklist.md:17:- [ ] Migration plan: extract current hardcoded copy/images, seed Supabase, maintain stable slugs/IDs.
../docs/05-planning/future-features/admin content self-service/shopify-sync-script.ts:1:// Shopify -> Supabase ingest (draft, staging). Not executed; reference only.
../docs/05-planning/future-features/admin content self-service/shopify-sync-script.ts:3:import { createClient } from "@supabase/supabase-js";
../docs/05-planning/future-features/admin content self-service/shopify-sync-script.ts:5:const SUPABASE_URL = process.env.VITE_SUPABASE_URL_ADMIN!;
../docs/05-planning/future-features/admin content self-service/shopify-sync-script.ts:6:const SUPABASE_ANON = process.env.VITE_SUPABASE_ANON_KEY_ADMIN!;
../docs/05-planning/future-features/admin content self-service/shopify-sync-script.ts:10:const supabase = createClient(SUPABASE_URL, SUPABASE_ANON);
../docs/05-planning/future-features/admin content self-service/shopify-sync-script.ts:51:  const { error } = await supabase.from("products").upsert({
../docs/05-planning/future-features/admin content self-service/admin-shell-outline.tsx:7:import { SupabaseAdminProvider } from "./supabase-admin-provider"; // to be created when wiring
../docs/05-planning/future-features/admin content self-service/admin-shell-outline.tsx:28:      <SupabaseAdminProvider>
../docs/05-planning/future-features/admin content self-service/admin-shell-outline.tsx:46:      </SupabaseAdminProvider>
../docs/05-planning/future-features/A-B testing components/hybrid-analytics-heatmaps-stack.md:12:- Data: Supabase is already the ‚Äúdata backbone‚Äù.
../docs/05-planning/future-features/A-B testing components/hybrid-analytics-heatmaps-stack.md:46:We originally planned ‚ÄúSupabase as canonical for all experiment events‚Äù, but **Supabase free storage can be tight** (you mentioned ~500MB). Raw event logs can outgrow that quickly.
../docs/05-planning/future-features/A-B testing components/hybrid-analytics-heatmaps-stack.md:61:## Storage strategy (given Supabase 500MB concerns)
../docs/05-planning/future-features/A-B testing components/hybrid-analytics-heatmaps-stack.md:67:- Keep Supabase focused on core app data + (optional) tiny experiment config/rollups.
../docs/05-planning/future-features/A-B testing components/hybrid-analytics-heatmaps-stack.md:94:- **Bigger than Supabase free DB** for ‚Äúanalytics-adjacent‚Äù storage: Turso‚Äôs free tier advertises **5GB storage**, **10M rows written/month**, **500M rows read/month**. That‚Äôs plenty for experiment configs + rollups, and can even support a moderate raw event log if we *really* wanted to. (See their pricing pages / plan announcement.)
../docs/05-planning/future-features/A-B testing components/hybrid-analytics-heatmaps-stack.md:99:- experiment configs (if we don‚Äôt want them in Supabase)
../docs/05-planning/future-features/A-B testing components/hybrid-analytics-heatmaps-stack.md:170:**Supabase**
../docs/05-planning/future-features/A-B testing components/hybrid-analytics-heatmaps-stack.md:176:- Supabase: ‚Äúauditable ground truth for analysis and later portability‚Äù
../docs/05-planning/future-features/A-B testing components/hybrid-analytics-heatmaps-stack.md:235:- **Low vendor lock-in**: Supabase keeps experiment history portable.
../docs/05-planning/future-features/A-B testing components/hybrid-analytics-heatmaps-stack.md:248:### Option B: Hotjar (free tier) + PostHog + Supabase
../docs/05-planning/future-features/A-B testing components/hybrid-analytics-heatmaps-stack.md:255:- Supabase as canonical store
../docs/05-planning/future-features/A-B testing components/hybrid-analytics-heatmaps-stack.md:259:### Option C: Clarity + Supabase only (no PostHog)
../docs/05-planning/future-features/A-B testing components/hybrid-analytics-heatmaps-stack.md:263:- Use Supabase for experiment measurement and dashboards (SQL views + a dashboard tool).
../docs/05-planning/future-features/admin content self-service/run-migration-instructions.md:4:- Staging Supabase project ref and service role key (do **not** use prod).
../docs/05-planning/future-features/admin content self-service/run-migration-instructions.md:5:- Supabase CLI installed and linked, or access via Lumelle Supabase MCP.
../docs/05-planning/future-features/admin content self-service/run-migration-instructions.md:8:### Option A: Supabase CLI (staging)
../docs/05-planning/future-features/admin content self-service/run-migration-instructions.md:11:   export SUPABASE_URL=https://<staging>.supabase.co
../docs/05-planning/future-features/admin content self-service/run-migration-instructions.md:12:   export SUPABASE_SERVICE_ROLE_KEY=<staging-service-role>
../docs/05-planning/future-features/admin content self-service/run-migration-instructions.md:16:   supabase db execute --file "docs/05-planning/future-features/admin content self-service/sql-migration-draft.sql"
../docs/05-planning/future-features/admin content self-service/run-migration-instructions.md:19:### Option B: Lumelle Supabase MCP
../docs/05-planning/future-features/admin content self-service/edge-function-publish.ts:3:import { createClient } from "https://esm.sh/@supabase/supabase-js@2.45.0";
../docs/05-planning/future-features/admin content self-service/edge-function-publish.ts:5:const supabaseUrl = Deno.env.get("SUPABASE_URL")!;
../docs/05-planning/future-features/admin content self-service/edge-function-publish.ts:6:const supabaseKey = Deno.env.get("SUPABASE_SERVICE_ROLE_KEY")!;
../docs/05-planning/future-features/admin content self-service/edge-function-publish.ts:7:const supabase = createClient(supabaseUrl, supabaseKey);
../docs/05-planning/future-features/admin content self-service/edge-function-publish.ts:20:  const client = supabase;
../docs/05-planning/future-features/admin content self-service/edge-function-rollback.ts:2:import { createClient } from "https://esm.sh/@supabase/supabase-js@2.45.0";
../docs/05-planning/future-features/admin content self-service/edge-function-rollback.ts:4:const supabaseUrl = Deno.env.get("SUPABASE_URL")!;
../docs/05-planning/future-features/admin content self-service/edge-function-rollback.ts:5:const supabaseKey = Deno.env.get("SUPABASE_SERVICE_ROLE_KEY")!;
../docs/05-planning/future-features/admin content self-service/edge-function-rollback.ts:6:const supabase = createClient(supabaseUrl, supabaseKey);
../docs/05-planning/future-features/admin content self-service/edge-function-rollback.ts:19:  const { data: version } = await supabase
../docs/05-planning/future-features/admin content self-service/edge-function-rollback.ts:27:  const { error } = await supabase.from(table).update(version.snapshot).eq("id", entity_id);
../docs/05-planning/future-features/admin content self-service/edge-function-rollback.ts:30:  await supabase.from("audits").insert({
../docs/05-planning/future-features/A-B testing components/migration-apply-guide.md:6:- Supabase staging project URL and service key.
../docs/05-planning/future-features/A-B testing components/migration-apply-guide.md:7:- psql or Supabase SQL editor access.
../docs/05-planning/future-features/A-B testing components/migration-apply-guide.md:12:   export SUPABASE_URL="<staging-db-connection-string>"
../docs/05-planning/future-features/A-B testing components/migration-apply-guide.md:13:   export SUPABASE_SERVICE_ROLE_KEY="<staging-service-role-key>"
../docs/05-planning/future-features/A-B testing components/migration-apply-guide.md:16:   - Using psql: `psql "$SUPABASE_URL" -f server/migrations/2025-12-11_experiments.sql`
../docs/05-planning/future-features/A-B testing components/migration-apply-guide.md:17:   - Or paste into Supabase SQL editor and run.
../docs/05-planning/future-features/admin content self-service/edge-functions-plan.md:18:- Use staging Supabase URL/service role for server-side reads/writes.
../docs/05-planning/future-features/admin content self-service/staging-rollout-checklist.md:4:- [ ] Confirm staging Supabase project ref and keys.
../docs/05-planning/future-features/admin content self-service/staging-rollout-checklist.md:25:- [ ] Add staged Supabase admin client instance (not yet in prod build).
../docs/05-planning/future-features/admin content self-service/staging-rollout-checklist.md:29:- [ ] Run Shopify ‚Üí Supabase ingest for sample set; import copy/media as draft.
../docs/05-planning/future-features/admin content self-service/products-pdp-schema.md:1:# Products PDP ‚Üí Supabase schema plan
../docs/05-planning/future-features/admin content self-service/products-pdp-schema.md:3:Goal: move the storefront PDP (product detail page) and its config out of hard-coded TS (`ProductConfig`) and into Supabase so the admin `/admin/products` screen can edit it and changes can go live without redeploying.
../docs/05-planning/future-features/admin content self-service/products-pdp-schema.md:7:- Store **all PDP data points** in Supabase in a shape that matches the existing UI components.
../docs/05-planning/future-features/admin content self-service/products-pdp-schema.md:20:Admin Products (currently a mock editor, not wired to Supabase yet):
../docs/05-planning/future-features/admin content self-service/products-pdp-schema.md:52:## Supabase schema mapping (v1)
../docs/05-planning/future-features/admin content self-service/products-pdp-schema.md:102:- `path` can be either a Supabase Storage path or a public path like `/uploads/...`
../docs/05-planning/future-features/admin content self-service/products-pdp-schema.md:111:2) Backfill current in-repo config ‚Üí Supabase
../docs/05-planning/future-features/admin content self-service/products-pdp-schema.md:113:3) Wire admin `/admin/products` to Supabase (draft mode)
../docs/05-planning/future-features/admin content self-service/products-pdp-schema.md:122:   - Frontend fallback: if Supabase has no published row for a handle, fall back to the existing hard-coded config so PDP never breaks during rollout.
../docs/05-planning/future-features/A-B testing components/checklist.md:45:8) Create Supabase tables/migrations for experiments, exposures, events, sessions.
../docs/05-planning/future-features/A-B testing components/checklist.md:57:20) Write SRM (sample ratio mismatch) monitor + missing-exposure checker as Supabase cron job.
../docs/05-planning/future-features/A-B testing components/state-of-play.md:25:- Decide staging Supabase credentials and enable flags there only.
../docs/05-planning/future-features/A-B testing components/state-of-play.md:27:- Confirm storage strategy: avoid raw event logs in Supabase (500MB concern); keep DB layer lean and use PostHog/Clarity for event-heavy data.
../docs/05-planning/future-features/A-B testing components/env-flags.md:20:# Supabase service (server-side only; never ship to client)
../docs/05-planning/future-features/A-B testing components/env-flags.md:21:SUPABASE_URL=
../docs/05-planning/future-features/A-B testing components/env-flags.md:22:SUPABASE_SERVICE_ROLE_KEY=
../docs/05-planning/future-features/A-B testing components/implementation-plan.md:6:- **Lean DB layer** (optional) only for configs/rollups (avoid raw event storage, especially with tight Supabase storage)
../docs/05-planning/future-features/A-B testing components/implementation-plan.md:96:23) Choose a lean DB (Turso recommended if Supabase storage is tight).
../functions/api/shopify/webhooks/fulfillments-create.ts:4:import { getSupabase } from '../../../_lib/supabase'
../functions/api/shopify/webhooks/fulfillments-create.ts:60:  const supabase = getSupabase(env)
../functions/api/shopify/webhooks/fulfillments-create.ts:61:  const { data: existing, error: readError } = await supabase
../functions/api/shopify/webhooks/fulfillments-create.ts:79:    const { error: updateError } = await supabase
../functions/api/shopify/webhooks/fulfillments-create.ts:106:      await supabase.from('customers').upsert(
../functions/api/shopify/webhooks/fulfillments-create.ts:111:      const { error: insertError } = await supabase.from('loyalty_points_ledger').insert([
../docs/05-planning/future-features/A-B testing components/server-stub.md:8:SUPABASE_URL=...
../docs/05-planning/future-features/A-B testing components/server-stub.md:9:SUPABASE_SERVICE_ROLE_KEY=...
../docs/05-planning/future-features/A-B testing components/server-stub.md:19:import { createClient } from '@supabase/supabase-js'
../docs/05-planning/future-features/A-B testing components/server-stub.md:23:const supabase = enabled
../docs/05-planning/future-features/A-B testing components/server-stub.md:24:  ? createClient(process.env.SUPABASE_URL!, process.env.SUPABASE_SERVICE_ROLE_KEY!)
../docs/05-planning/future-features/A-B testing components/server-stub.md:28:  if (!enabled || !supabase) return res.sendStatus(404)
../docs/05-planning/future-features/A-B testing components/server-stub.md:30:  const { data, error } = await supabase
../docs/05-planning/future-features/A-B testing components/server-stub.md:68:  if (!enabled || !supabase) return res.sendStatus(404)
../docs/05-planning/future-features/A-B testing components/server-stub.md:83:    const { error } = await supabase.from('experiment_exposures').insert(exposures)
../docs/05-planning/future-features/A-B testing components/server-stub.md:88:    const { error } = await supabase.from('events').insert(events)
../docs/05-planning/future-features/A-B testing components/server-stub.md:91:    // Option B (recommended if Supabase storage is tight): forward events to PostHog and do not store raw events in DB.
../docs/05-planning/future-features/A-B testing components/server-stub.md:93:    // - Supabase remains focused on core app data + experiment config/rollups.
../functions/api/shopify/webhooks/app-uninstalled.ts:4:import { getSupabase } from '../../../_lib/supabase'
../functions/api/shopify/webhooks/app-uninstalled.ts:22:    const supabase = getSupabase(env)
../functions/api/shopify/webhooks/app-uninstalled.ts:23:    await supabase.from('Session').delete().eq('id', `offline_${shop}`)
../README.md:30:Copy `.env.example` to `.env` and fill Shopify/Supabase/Clerk keys as needed. See `docs/architecture/ARCHITECTURE-HOWTO.md` for details.
../README.md:32:## Shopify webhooks (orders ‚Üí Supabase)
../functions/api/shopify/webhooks/shop-redact.ts:4:import { getSupabase } from '../../../_lib/supabase'
../functions/api/shopify/webhooks/shop-redact.ts:19:  const supabase = getSupabase(env)
../functions/api/shopify/webhooks/shop-redact.ts:20:  const { error } = await supabase.from('ShopCustomers').delete().eq('shop', String(shop))
../functions/api/shopify/webhooks/orders-updated.ts:6:import { getSupabase } from '../../../_lib/supabase'
../functions/api/shopify/webhooks/orders-updated.ts:70:      const supabase = getSupabase(env)
../functions/api/shopify/webhooks/orders-updated.ts:72:      const { data: order, error: orderError } = await supabase
../functions/api/shopify/webhooks/orders-updated.ts:85:        await supabase.from('customers').upsert(
../functions/api/shopify/webhooks/orders-updated.ts:91:        const { data: awarded, error: awardError } = await supabase
../functions/api/shopify/webhooks/orders-updated.ts:104:          const { error: insertError } = await supabase.from('loyalty_points_ledger').insert([
../functions/api/metrics/top-skus.ts:2:import { getSupabase } from '../../_lib/supabase'
../functions/api/metrics/top-skus.ts:12:  const supabase = getSupabase(env)
../functions/api/metrics/top-skus.ts:13:  const { data, error } = await supabase.rpc('lumelle_metrics_top_skus', { days })
../functions/api/shopify/session.ts:2:import { getSupabase } from '../../_lib/supabase'
../functions/api/shopify/session.ts:12:  const supabase = getSupabase(env)
../functions/api/shopify/session.ts:13:  const { data, error } = await supabase.from('Session').select('id').eq('id', `offline_${shop}`).limit(1)
../functions/api/metrics/refund-rate.ts:2:import { getSupabase } from '../../_lib/supabase'
../functions/api/metrics/refund-rate.ts:12:  const supabase = getSupabase(env)
../functions/api/metrics/refund-rate.ts:13:  const { data, error } = await supabase.rpc('lumelle_metrics_refund_rate', { days })
../docs/05-planning/future-features/A-B testing components/handoff-into-code.md:39:   - `SUPABASE_URL`, `SUPABASE_SERVICE_ROLE_KEY` (or Turso secrets)
../docs/05-planning/future-features/A-B testing components/handoff-into-code.md:40:2) Apply migration on staging Supabase:
../functions/api/metrics/refunds-by-sku.ts:2:import { getSupabase } from '../../_lib/supabase'
../functions/api/metrics/refunds-by-sku.ts:12:  const supabase = getSupabase(env)
../functions/api/metrics/refunds-by-sku.ts:13:  const { data, error } = await supabase.rpc('lumelle_metrics_refunds_by_sku', { days })
../functions/api/metrics/summary.ts:2:import { getSupabase } from '../../_lib/supabase'
../functions/api/metrics/summary.ts:7:  const supabase = getSupabase(env)
../functions/api/metrics/summary.ts:8:  const { data, error } = await supabase.rpc('lumelle_metrics_summary')
../docs/05-planning/future-features/A-B testing components/tooling-options.md:3:Goal: avoid reinventing wheels for flags/experiments and heatmaps/replay, while keeping Supabase as our data backbone **and** keeping client deployments inside free tiers by default.
../docs/05-planning/future-features/A-B testing components/tooling-options.md:11:- Canonical experiment portability: **lean DB layer** (Supabase config and/or rollups; avoid raw event logs if storage is tight)
../docs/05-planning/future-features/A-B testing components/tooling-options.md:32:- Centralize experiment config & targeting (growthbook/featbit UI) instead of homegrown tables, while keeping our Supabase events for analysis.
../docs/05-planning/future-features/A-B testing components/tooling-options.md:38:- Use vendor SDK for assignment + flag fetch; still log exposures/events via `/api/experiment/track` so Supabase remains the metric store.
../docs/05-planning/future-features/A-B testing components/tooling-options.md:40:- Optionally ingest vendor summaries into Supabase or Metabase; keep a single dashboard surface.
../docs/05-planning/future-features/A-B testing components/tooling-options.md:44:- Keep data layer unified (Supabase tables + view) so we can swap providers without losing history.
../docs/05-planning/future-features/A-B testing components/tooling-options.md:52:3) Regardless of tool choice, keep `/api/experiment/track` logging so Supabase remains the source of truth for metrics.
../functions/api/metrics/repeat.ts:2:import { getSupabase } from '../../_lib/supabase'
../functions/api/metrics/repeat.ts:7:  const supabase = getSupabase(env)
../functions/api/metrics/repeat.ts:8:  const { data, error } = await supabase.rpc('lumelle_metrics_repeat')
../docs/05-planning/future-features/A-B testing components/srm-missing-exposure-cron.sql:1:-- SRM + missing-exposure checks (run daily via Supabase cron)
../functions/api/metrics/daily.ts:2:import { getSupabase } from '../../_lib/supabase'
../functions/api/metrics/daily.ts:12:  const supabase = getSupabase(env)
../functions/api/metrics/daily.ts:13:  const { data, error } = await supabase.rpc('lumelle_metrics_daily', { days })
../docs/05-planning/future-features/A-B testing components/staging-runbook.md:6:- No raw click/event tables stored in Supabase by default
../docs/05-planning/future-features/A-B testing components/staging-runbook.md:27:   - **Path B (fallback):** DB-backed config using Supabase/Turso (requires migration + `/api/experiment/*` routes).
../docs/05-planning/future-features/A-B testing components/staging-runbook.md:32:     - `SUPABASE_URL`, `SUPABASE_SERVICE_ROLE_KEY` (staging project) or Turso secrets
../docs/05-planning/future-features/A-B testing components/staging-runbook.md:33:   - Apply migration to staging Supabase:
../docs/05-planning/future-features/A-B testing components/staging-runbook.md:34:     - Supabase SQL editor ‚Üí run `server/migrations/2025-12-11_experiments.sql`
../functions/api/metrics/utm-sources.ts:2:import { getSupabase } from '../../_lib/supabase'
../functions/api/metrics/utm-sources.ts:12:  const supabase = getSupabase(env)
../functions/api/metrics/utm-sources.ts:13:  const { data, error } = await supabase.rpc('lumelle_metrics_utm_sources', { days })
../docs/05-planning/future-features/A-B testing components/implementation-notes.md:22:import { createClient } from '@supabase/supabase-js'
../docs/05-planning/future-features/A-B testing components/implementation-notes.md:23:const supabase = createClient(process.env.SUPABASE_URL!, process.env.SUPABASE_SERVICE_ROLE_KEY!)
../docs/05-planning/future-features/A-B testing components/implementation-notes.md:26:  const { data, error } = await supabase
../docs/05-planning/future-features/A-B testing components/implementation-notes.md:43:  const { error: exErr } = await supabase.from('experiment_exposures').insert(exposures)
../docs/05-planning/future-features/A-B testing components/implementation-notes.md:44:  const { error: evErr } = await supabase.from('events').insert(events)
../docs/05-planning/future-features/A-B testing components/implementation-notes.md:65:- Add env vars: `SUPABASE_URL`, `SUPABASE_SERVICE_ROLE_KEY` for server; `VITE_SUPABASE_URL`, `VITE_SUPABASE_ANON_KEY` already used client-side.
../docs/05-planning/future-features/A-B testing components/implementation-notes.md:79:1) Apply migration to Supabase (replace role names if needed).
../functions/api/metrics/source-revenue.ts:2:import { getSupabase } from '../../_lib/supabase'
../functions/api/metrics/source-revenue.ts:12:  const supabase = getSupabase(env)
../functions/api/metrics/source-revenue.ts:13:  const { data, error } = await supabase.rpc('lumelle_metrics_source_revenue', { days })
../functions/api/shopify/auth/callback.ts:5:import { getSupabase } from '../../../_lib/supabase'
../functions/api/shopify/auth/callback.ts:34:  const supabase = getSupabase(env)
../functions/api/shopify/auth/callback.ts:35:  const { error } = await supabase.from('Session').upsert(
../docs/05-planning/future-features/A-B testing components/build-steps-worklog.md:21:  - `SUPABASE_URL=`
../docs/05-planning/future-features/A-B testing components/build-steps-worklog.md:22:  - `SUPABASE_SERVICE_ROLE_KEY=`
../docs/05-planning/future-features/A-B testing components/build-steps-worklog.md:28:- [ ] Apply migration to staging Supabase.
../docs/05-planning/future-features/admin content self-service/shopify-sync-notes.md:1:# Shopify ‚Üí Supabase ingest (read-only, staging-first)
../docs/05-planning/future-features/admin content self-service/shopify-sync-notes.md:3:Objective: mirror product copy/media from Shopify into Supabase so admins can edit and publish from our UI. No writes back to Shopify.
../docs/05-planning/future-features/admin content self-service/shopify-sync-notes.md:16:   - Upsert products into Supabase `products` by handle.
../docs/05-planning/future-features/A-B testing components/optimization-loop.md:138:### Supabase (canonical + portability)
../docs/05-planning/future-features/A-B testing components/integration-plan.md:11:- **Lean DB layer** (Supabase or Turso) ‚Üí configs + optional rollups only (not raw event firehose)
../docs/05-planning/future-features/A-B testing components/integration-plan.md:26:- Supabase storage is limited; avoid storing raw click/event firehose
../docs/05-planning/future-features/A-B testing components/integration-plan.md:58:### Optional lean DB (Supabase or Turso)
../docs/05-planning/future-features/A-B testing components/integration-plan.md:197:If Supabase storage is constrained and we still want a DB-backed ‚Äúsingle truth‚Äù for experiment configs/rollups:
../docs/05-planning/future-features/admin content self-service/media-placeholders-plan.md:12:1) Generate via node-canvas or sharp locally, then `supabase storage upload ... --content-type image/webp --upsert --cache-control 31536000`.
../functions/_lib/shopOrders.ts:2:import { getSupabase } from './supabase'
../functions/_lib/shopOrders.ts:30:  const supabase = getSupabase(env)
../functions/_lib/shopOrders.ts:60:  const { error } = await supabase.from('ShopOrders').upsert([record], { onConflict: 'shop,order_id' })
../functions/_lib/shopOrders.ts:70:  const supabase = getSupabase(env)
../functions/_lib/shopOrders.ts:76:  const { error } = await supabase.from('ShopOrders').update(update).eq('shop', shop).eq('order_id', orderId)
../docs/05-planning/future-features/admin content self-service/implementation-plan.md:12:- Staging env file: `.env.admin.example` with staging Supabase URL/anon keys and bucket names; keep existing `.env` untouched.
../docs/05-planning/future-features/admin content self-service/implementation-plan.md:15:- Shopify sync points to staging Supabase; read-only from Shopify (no write-back).
../docs/05-planning/future-features/admin content self-service/implementation-plan.md:36:- Auth: Clerk-first. Supabase access is enforced via RLS and authenticated using a Clerk JWT template named `supabase`.
../docs/05-planning/future-features/admin content self-service/implementation-plan.md:41:## Shopify ‚Üí Supabase (staging)
../docs/05-planning/future-features/admin content self-service/implementation-plan.md:49:4) Hook staging env in `.env.admin` (local) using staging Supabase keys.
../functions/_lib/supabase.ts:1:import { createClient, type SupabaseClient } from '@supabase/supabase-js'
../functions/_lib/supabase.ts:4:type Cached = { key: string; client: SupabaseClient }
../functions/_lib/supabase.ts:7:export function getSupabase(env: Env) {
../functions/_lib/supabase.ts:8:  const url = env.SUPABASE_URL
../functions/_lib/supabase.ts:9:  const key = env.SUPABASE_SERVICE_ROLE_KEY
../functions/_lib/supabase.ts:11:    throw new Error('Missing SUPABASE_URL or SUPABASE_SERVICE_ROLE_KEY')
../docs/05-planning/future-features/admin content self-service/forms-and-schemas-notes.md:7:- Schema to match Supabase columns; coercions for numbers/arrays.
../functions/_lib/types.ts:2:  // Supabase (server-side)
../functions/_lib/types.ts:3:  SUPABASE_URL?: string
../functions/_lib/types.ts:4:  SUPABASE_SERVICE_ROLE_KEY?: string
../functions/_lib/shopCustomers.ts:2:import { getSupabase } from './supabase'
../functions/_lib/shopCustomers.ts:31:  const supabase = getSupabase(env)
../functions/_lib/shopCustomers.ts:55:  const { error } = await supabase.from('ShopCustomers').upsert([record], { onConflict: 'shop,customer_id' })
../functions/_lib/shopCustomers.ts:60:  const supabase = getSupabase(env)
../functions/_lib/shopCustomers.ts:61:  const { error } = await supabase.from('ShopCustomers').delete().eq('shop', shop).eq('customer_id', id)
../functions/_lib/shopCustomers.ts:66:  const supabase = getSupabase(env)
../functions/_lib/shopCustomers.ts:68:    const { error } = await supabase.from('ShopCustomers').delete().eq('shop', shop).eq('customer_id', emailOrId.id)
../functions/_lib/shopCustomers.ts:73:    const { error } = await supabase.from('ShopCustomers').delete().eq('shop', shop).eq('email', emailOrId.email.toLowerCase())
../functions/_lib/webhooks.ts:2:import { getSupabase } from './supabase'
../functions/_lib/webhooks.ts:6:  const supabase = getSupabase(env)
../functions/_lib/webhooks.ts:7:  const { data, error } = await supabase.from('ShopWebhookDeliveries').select('id').eq('id', deliveryId).limit(1)
../functions/_lib/webhooks.ts:14:  const supabase = getSupabase(env)
../functions/_lib/webhooks.ts:15:  const { error } = await supabase.from('ShopWebhookDeliveries').upsert([{ id: deliveryId }], { onConflict: 'id' })
../docs/05-planning/future-features/admin content self-service/integration-readiness.md:5:- Staging Supabase URL/anon keys available in `.env.admin`; prod env untouched.
../docs/05-planning/future-features/admin content self-service/integration-readiness.md:6:- Supabase types generated for staging schema and committed (or generated on CI).
../docs/05-planning/future-features/admin content self-service/integration-readiness.md:7:- Clerk JWT template `supabase` includes admin role claims (see Security).
../docs/05-planning/future-features/admin content self-service/integration-readiness.md:10:- Add admin Supabase client factory using staging env vars.
../docs/05-planning/future-features/admin content self-service/integration-readiness.md:17:- Public app continues to read its existing sources; no swaps to Supabase content until explicitly done.
../docs/05-planning/future-features/admin content self-service/integration-readiness.md:28:- Auth is Clerk-first; Supabase is protected via RLS + Edge Functions.
../docs/05-planning/future-features/admin content self-service/integration-readiness.md:29:- Configure Clerk JWT template `supabase` to include `app_metadata.roles` (array) and include `"admin"` for admin users.
../functions/_lib/shopifyAdmin.ts:2:import { getSupabase } from './supabase'
../functions/_lib/shopifyAdmin.ts:9:  const supabase = getSupabase(env)
../functions/_lib/shopifyAdmin.ts:10:  const { data, error } = await supabase.from('Session').select('accesstoken').eq('id', `offline_${shop}`).limit(1).maybeSingle()
../functions/_lib/customers.ts:2:import { getSupabase } from './supabase'
../functions/_lib/customers.ts:5:  const supabase = getSupabase(env)
../functions/_lib/customers.ts:28:  const { error } = await supabase.from('customers').upsert([record], { onConflict: 'id' })
../api/storefront/cart/share.ts:14:  // TODO: store snapshot or cartId ref in Supabase/R2 and use snapshotRef instead of inline snapshot.
../docs/05-planning/future-features/admin content self-service/fixtures-seeding-plan.md:17:3) Insert seed rows via Supabase SQL or script; keep status=draft except one published example per type.
../docs/05-planning/future-features/admin content self-service/cachecontrol-notes.md:1:# Cache-Control notes (Supabase Storage)
../docs/05-planning/future-features/admin content self-service/cachecontrol-notes.md:3:Supabase buckets don't store a default cache_control column per object; set per-upload or via `upload` API options.
../docs/05-planning/future-features/admin content self-service/cachecontrol-notes.md:11:await supabaseAdmin.storage
../docs/05-planning/future-features/admin content self-service/research-notes.md:3:Storage stack: Supabase Storage (fixed).
../docs/05-planning/future-features/admin content self-service/research-notes.md:19:## Content models on Supabase
../docs/05-planning/future-features/admin content self-service/research-notes.md:28:## Image pipeline (Supabase Storage)
../docs/05-planning/future-features/admin content self-service/research-notes.md:35:- Supabase CDN caches all assets; Smart CDN (Pro+) auto revalidates when object updates/deletes and shields against query-string misses.
../docs/05-planning/future-features/admin content self-service/research-notes.md:69:- Migrations + seed fixtures in repo; types generated from SQL (supabase gen types); local preview data; lint that forbids missing alt/seo fields; storybook-style fixtures fed by mock data.
../docs/05-planning/future-features/admin content self-service/research-notes.md:94:- Write migration script to extract existing hardcoded copy/media into Supabase tables and storage paths; dry run on staging.
../docs/05-planning/future-features/admin content self-service/research-notes.md:107:- Begin migration of existing copy/media into staging Supabase; reconcile slugs/IDs.
../docs/05-planning/future-features/admin content self-service/research-notes.md:116:- Storage: Supabase Storage fixed. ‚úÖ
../docs/05-planning/future-features/admin content self-service/research-notes.md:117:- CMS approach: pending (hosted headless vs self-hosted vs bespoke on Supabase). Need cost/complexity comparison and alignment with client IT.
../docs/05-planning/future-features/admin content self-service/research-notes.md:121:- Access model: confirm SSO vs Supabase Auth accounts; needed for roles/RLS claims.
../docs/05-planning/future-features/admin content self-service/research-notes.md:145:- Migration dry-run: export existing copy/media, import to staging Supabase, compare slugs/IDs.
../docs/05-planning/future-features/admin content self-service/research-notes.md:154:- Auth source decision (SSO vs Supabase Auth) needed before finalizing RLS and JWT claims.
../docs/05-planning/future-features/admin content self-service/research-notes.md:210:  supabase.storage.from('product-media').getPublicUrl(path, preset(1200,800,75));
../docs/05-planning/future-features/admin content self-service/research-notes.md:262:- Use typed clients generated from Supabase types; SWR/react-query with key `[mode, slug]`.
../docs/05-planning/future-features/admin content self-service/status.md:10:## What‚Äôs done (Supabase / staging foundation)
../docs/05-planning/future-features/admin content self-service/status.md:23:  - Primary gate: Clerk JWT template `supabase` ‚Üí reads `app_metadata.roles` and requires `"admin"`.
../docs/05-planning/future-features/admin content self-service/status.md:24:  - Dev-only fallback: `VITE_ADMIN_EMAILS` allowlist can open the UI **only in DEV** (does not bypass Supabase RLS).
../docs/05-planning/future-features/admin content self-service/status.md:27:  - Reads `cms_pages` via Supabase with the Clerk JWT bearer token.
../docs/05-planning/future-features/admin content self-service/status.md:28:  - Shows a ‚ÄúConnection check‚Äù panel (Supabase host + detected roles + visible row count).
../docs/05-planning/future-features/admin content self-service/status.md:30:  - Can call `preview-content` Edge Function to verify the end-to-end chain (Clerk JWT ‚Üí Supabase RLS ‚Üí Edge Function auth).
../docs/05-planning/future-features/admin content self-service/status.md:37:Goal: ensure the Clerk JWT template `supabase` includes `app_metadata.roles: ["admin"]`.
../docs/05-planning/future-features/admin content self-service/status.md:40:- Supabase RLS policies + Edge Functions also check it.
../docs/05-planning/future-features/admin content self-service/status.md:53:### Step B ‚Äî configure the Clerk JWT template `supabase`
../docs/05-planning/future-features/admin content self-service/status.md:55:- Configure ‚Üí JWT Templates ‚Üí template named `supabase`
../docs/05-planning/future-features/admin content self-service/status.md:123:- `VITE_ADMIN_EMAILS` only bypasses the **UI gate** in dev; it won‚Äôt bypass Supabase RLS or Edge Functions.
../docs/05-planning/future-features/admin content self-service/status.md:125:  - `Authorization: Bearer <Clerk supabase JWT>`
../docs/05-planning/future-features/admin content self-service/status.md:126:  - `apikey: <Supabase anon key>`
../functions/api/admin/orders/list.ts:2:import { getSupabase } from '../../../_lib/supabase'
../functions/api/admin/orders/list.ts:104:  const supabase = getSupabase(env)
../functions/api/admin/orders/list.ts:106:  let query = supabase
../functions/api/admin/orders/get.ts:2:import { getSupabase } from '../../../_lib/supabase'
../functions/api/admin/orders/get.ts:97:  const supabase = getSupabase(env)
../functions/api/admin/orders/get.ts:101:  const { data, error } = await supabase
../docs/05-planning/future-features/admin content self-service/media-upload-checklist.md:15:2) Upload via Supabase Storage UI or CLI:
../docs/05-planning/future-features/admin content self-service/media-upload-checklist.md:17:   supabase storage upload product-media/products/rose-serum/1.webp path/to/1.webp --bucket product-media
../docs/05-planning/future-features/admin content self-service/media-upload-checklist.md:18:   supabase storage upload product-media/products/rose-serum/2.webp path/to/2.webp --bucket product-media
../docs/05-planning/future-features/admin content self-service/media-upload-checklist.md:19:   supabase storage upload blog-media/blogs/winter/hero.webp path/to/hero.webp --bucket blog-media
../docs/05-planning/future-features/admin content self-service/media-upload-checklist.md:20:   supabase storage upload blog-media/blogs/winter/inline1.webp path/to/inline1.webp --bucket blog-media
../scripts/upload-images-to-supabase.mjs:1:import { createClient } from '@supabase/supabase-js'
../scripts/upload-images-to-supabase.mjs:5:const SUPABASE_URL = process.env.SUPABASE_URL || process.env.VITE_SUPABASE_URL
../scripts/upload-images-to-supabase.mjs:6:const { SUPABASE_SERVICE_ROLE_KEY, SUPABASE_BUCKET = 'public' } = process.env
../scripts/upload-images-to-supabase.mjs:8:if (!SUPABASE_SERVICE_ROLE_KEY || !SUPABASE_URL) {
../scripts/upload-images-to-supabase.mjs:9:  console.error('Missing SUPABASE_SERVICE_ROLE_KEY or SUPABASE_URL env vars.')
../scripts/upload-images-to-supabase.mjs:13:const supabase = createClient(SUPABASE_URL, SUPABASE_SERVICE_ROLE_KEY)
../scripts/upload-images-to-supabase.mjs:42:    const { error } = await supabase.storage.from(SUPABASE_BUCKET).upload(dest, buf, {
../scripts/check-import-boundaries.mjs:44:    id: 'ui_imports_supabase_sdk',
../scripts/check-import-boundaries.mjs:45:    reason: 'Infrastructure SDKs (Supabase) must only be imported in the platform layer.',
../scripts/check-import-boundaries.mjs:46:    test: (spec) => spec === '@supabase/supabase-js',
../docs/05-planning/future-features/admin content self-service/admin-frontend-plan.md:5:- Use a separate Supabase client pointing to staging project for all admin data.
../docs/05-planning/future-features/admin content self-service/admin-frontend-plan.md:34:- `supabaseAdminClient` built from `VITE_SUPABASE_URL_ADMIN` + `VITE_SUPABASE_ANON_KEY_ADMIN`.
../docs/05-planning/future-features/admin content self-service/admin-frontend-plan.md:35:- Type bindings generated from Supabase types (staging).
../docs/05-planning/future-features/admin content self-service/admin-frontend-plan.md:57:2) Wire admin Supabase client and auth provider.
../scripts/clerk-grant-admin.mjs:86:  console.log('- Ensure Clerk JWT template "supabase" includes app_metadata.roles from user.public_metadata.roles')
../docs/05-planning/future-features/admin content self-service/admin-ui-design.md:5:Goal: a web admin where non-technical users can edit site copy, images, products, blogs, and globals. Backed by Supabase (DB + Storage) with draft/preview/publish, roles, and audit history.
../docs/05-planning/future-features/admin content self-service/admin-ui-design.md:31:   - Data: Supabase Auth users + role claims; audit log uses `audits`.
../docs/05-planning/future-features/admin content self-service/admin-ui-design.md:47:- Reads: client ‚Üí Supabase client ‚Üí tables / Storage public URLs (published) or signed URLs (draft/private).
../docs/05-planning/future-features/admin content self-service/admin-ui-design.md:58:- Generate TS types from Supabase schema; update frontend fetchers to consume DB-driven content instead of hardcoded strings/assets.
../docs/05-planning/future-features/admin content self-service/admin-ui-design.md:132:- **React Admin + ra-supabase-core**: mature React admin framework; scaffolds CRUD from Supabase schema; supports auth/permissions and theming. Good for core CRUD on pages/sections/products/blogs/globals and approval queues.
../docs/05-planning/future-features/admin content self-service/admin-ui-design.md:133:- **Refine**: React meta-framework with official `@refinedev/supabase`; lighter shell if we want custom UI with provided data/auth providers.
../docs/05-planning/future-features/admin content self-service/admin-ui-design.md:134:- **Dashibase (GPL)**: Supabase-native Notion-like builder; useful to borrow block-based section editing patterns and column-level ACL UI; can self-host for internal ops.
../docs/05-planning/future-features/admin content self-service/admin-ui-design.md:135:- **Supawald (Apache 2.0)**: Next.js headless CMS for Supabase Storage; ready media library UX (drag/drop, focal, auth) to embed or reuse for Media Library.
../docs/05-planning/future-features/admin content self-service/admin-ui-design.md:140:   - Use React Admin with Supabase data provider; generate resources for `pages`, `sections`, `products`, `product_media`, `blogs`, `blog_blocks`, `globals`.  
../docs/05-planning/future-features/admin content self-service/admin-ui-design.md:141:   - Wire Supabase auth; map JWT roles to RA auth provider.
../docs/05-planning/future-features/admin content self-service/admin-ui-design.md:153:   - RA `canAccess` hooks + Supabase RLS; hide/disable actions by roles (admin/editor/contributor/media-manager).  
../docs/05-planning/future-features/admin content self-service/admin-ui-design.md:162:- **Week 1**: RA scaffold + Supabase provider; auth hookup; base CRUD for pages/sections/products/blogs/globals; import Supawald media component; buckets wired.
../docs/05-planning/future-features/admin content self-service/admin-ui-design.md:167:1) Confirm auth model (Supabase Auth vs SSO) and role claims format.
../docs/05-planning/future-features/admin content self-service/admin-ui-design.md:174:8) Generate Supabase types (TS) into the app workspace.
../docs/05-planning/future-features/admin content self-service/admin-ui-design.md:179:13) Scaffold React Admin app with Supabase data provider.
../docs/05-planning/future-features/admin content self-service/admin-ui-design.md:180:14) Wire RA auth provider to Supabase auth + role claims.
../docs/05-planning/future-features/admin content self-service/admin-ui-design.md:219:- Auth: Supabase; only admins access the admin UI; approvals not required initially.
../docs/05-planning/future-features/admin content self-service/admin-ui-design.md:220:- Plan: Supabase Free; assume no Smart CDN or server-side image transformations‚Äîplan for client-side/Edge transforms.
../docs/05-planning/future-features/admin content self-service/admin-ui-design.md:222:- Products: source of truth in Shopify; UI currently hardcoded‚Äîneed to ingest/sync into Supabase for editable copy/media or read from Shopify and cache in Supabase.
../src/domains/client/account/index.ts:8:export * from './hooks/useSyncUserToSupabase'
../package.json:19:    "upload:images": "node scripts/upload-images-to-supabase.mjs",
../package.json:34:    "@supabase/supabase-js": "^2.83.0",
../api/_lib/README.md:2:Express webhook/dev server for local integration tests (Shopify/Clerk/Supabase). Not shipped to the client bundle. Keep API logic domain-agnostic; per-domain handlers should live with the domain and be imported here.
../api/internal/recovery-cron.ts:5:  // TODO: hook into Supabase + Resend; for now, return not implemented.
../docs/05-planning/future-features/admin content self-service/upload-flow-notes.md:1:# Upload flow notes (client-side, Supabase Free plan)
../docs/05-planning/future-features/admin content self-service/upload-flow-notes.md:4:- Supabase Free: no built-in image transformations/CDN invalidate; limited Storage (500 MB).
../docs/05-planning/future-features/admin content self-service/edge-function-preview.ts:3:import { createClient } from "https://esm.sh/@supabase/supabase-js@2.45.0";
../docs/05-planning/future-features/admin content self-service/edge-function-preview.ts:5:const supabaseUrl = Deno.env.get("SUPABASE_URL")!;
../docs/05-planning/future-features/admin content self-service/edge-function-preview.ts:6:const supabaseKey = Deno.env.get("SUPABASE_SERVICE_ROLE_KEY")!;
../docs/05-planning/future-features/admin content self-service/edge-function-preview.ts:7:const supabase = createClient(supabaseUrl, supabaseKey);
../docs/05-planning/future-features/admin content self-service/edge-function-preview.ts:18:  return supabase.storage.from(bucket).createSignedUrl(path, expires);
../docs/05-planning/future-features/admin content self-service/edge-function-preview.ts:55:  const { data: page } = await supabase
../docs/05-planning/future-features/admin content self-service/edge-function-preview.ts:65:  const { data: product } = await supabase
../docs/05-planning/future-features/admin content self-service/edge-function-preview.ts:75:  const { data: blog } = await supabase
../docs/05-planning/future-features/admin content self-service/admin-flag-and-routing.md:7:- `VITE_SUPABASE_URL_ADMIN`, `VITE_SUPABASE_ANON_KEY_ADMIN` (staging)
../docs/05-planning/future-features/admin content self-service/admin-flag-and-routing.md:16:  // Clerk-first: get the Clerk JWT template `supabase` and verify roles from claims.
../docs/05-planning/future-features/admin content self-service/admin-flag-and-routing.md:17:  const token = await getClerkToken({ template: 'supabase' })
../docs/05-planning/future-features/admin content self-service/admin-flag-and-routing.md:30:## Supabase clients
../docs/05-planning/future-features/admin content self-service/admin-flag-and-routing.md:32:- Create separate admin client instance pointing to staging Supabase URL/anon key; use only inside `/admin`.
../docs/05-planning/future-features/admin content self-service/admin-flag-and-routing.md:39:- Supabase Auth admin users only; roles in `app_metadata.roles` containing `admin`.
../docs/05-planning/future-features/admin content self-service/testing-plan.md:9:- Supabase client CRUD: create/read/update/delete for each table under admin JWT.
../src/domains/client/account/hooks/useSyncUserToSupabase.ts:3:import { createSupabaseClient, supabase } from '@platform/storage/supabase'
../src/domains/client/account/hooks/useSyncUserToSupabase.ts:20:export const useSyncUserToSupabase = () => {
../src/domains/client/account/hooks/useSyncUserToSupabase.ts:47:      const token = await getToken({ template: 'supabase' }).catch(() => null)
../src/domains/client/account/hooks/useSyncUserToSupabase.ts:48:      const client = token ? createSupabaseClient(token) : supabase
../src/domains/client/account/hooks/useSyncUserToSupabase.ts:52:        console.error('Failed to sync Clerk user to Supabase', error)
../src/domains/client/account/state/OrdersStore.ts:1:import { createSupabaseClient, supabase } from '@platform/storage/supabase'
../src/domains/client/account/state/OrdersStore.ts:23:  if (authToken) return createSupabaseClient(authToken)
../src/domains/client/account/state/OrdersStore.ts:24:  return supabase
../src/domains/client/account/state/OrdersStore.ts:59:    console.error('Supabase fetchOrders failed; falling back to cache', error)
../src/domains/client/account/state/OrdersStore.ts:80:    console.error(`Supabase fetchOrderById failed for ${id}; using cache`, error)
../src/domains/client/account/state/OrdersStore.ts:99:    console.error('Supabase addOrder failed; order is only saved locally', error)
../src/domains/admin/pages/data/pages.ts:150:      { title: 'Vendors', body: 'Shopify, Supabase, Clerk, PostHog ‚Äî DPIAs on file.' },
../docs/08-meta/repo/meta/STRUCTURE-PLAN.md:44:- Domain logic/data moved: shop logic (product, shopifyCart, shopify) and supabase client; landing logic (sections, seo) now under domain folders with stubs left in `src/lib`.
../src/domains/admin/pages/ui/pages/PagesPage.tsx:156:      { title: 'Vendors', body: 'Shopify, Supabase, Clerk, PostHog ‚Äî DPIAs on file.' },
../docs/08-meta/repo/meta/domains-README.md:8:- `platform/` ‚Äì `auth/`, `commerce/` (Shopify), `storage/` (Supabase), plus `cms/`, `feature-flags/`, `observability/`, `design-tokens/`
../docs/08-meta/repo/docs-ledger.md:47:- `2025-12-29 ‚Äî planning ‚Äî supabase-multitenancy-decoupled-backend ‚Äî docs/05-planning/research/supabase-multitenancy-decoupled-backend.md ‚Äî artifacts: docs/.blackbox/.plans/2025-12-29_1901_supabase-multitenancy-decoupled-backend-cloudflare/`
../src/domains/admin/orders/ui/pages/OrdersPage.tsx:179:      subtitle="Prototype UI. Next: wire to Shopify (or Supabase mirror), then add search + actions."
../src/domains/admin/orders/ui/pages/OrdersPage.tsx:187:            {ordersSource === 'api' ? 'Supabase mirror' : 'Mock data'}
../docs/01-product/admin/products.md:5:## 1) Catalog basics (from Shopify/Supabase)
../docs/01-product/admin/products.md:93:1) Wire the admin Products page to read/write this shape (Supabase table or JSONB per product keyed by Shopify product ID/handle).
../docs/01-product/admin/products-refactor-plan.md:7:- Supabase draft save behavior
../docs/01-product/admin/products-refactor-plan.md:17:   - UI sections should not know about Supabase.
../docs/01-product/admin/products-refactor-plan.md:35:- Supabase fetch/save + media upsert
../docs/01-product/admin/products-refactor-plan.md:61:‚îÇ   ‚îú‚îÄ‚îÄ productsRepo.ts              # low-level Supabase queries
../docs/01-product/admin/products-refactor-plan.md:62:‚îÇ   ‚îî‚îÄ‚îÄ productMediaRepo.ts          # low-level Supabase media queries
../docs/01-product/admin/products-refactor-plan.md:123:- No section imports Supabase or router.
../docs/01-product/admin/products-refactor-plan.md:135:- `data/*Repo.ts` = Supabase calls only
../docs/01-product/admin/products-refactor-plan.md:140:- `ProductsPage` contains no Supabase calls.
../docs/01-product/admin/products-architecture.md:7:  - Data fetching/saving (Supabase), snapshots, role debug.
../src/domains/admin/blog/ui/pages/BlogsPage.tsx:250:      subtitle="Blog posts and metrics live in Supabase (cms_blogs + cms_blog_media)."
../src/domains/admin/blog/ui/pages/BlogsPage.tsx:606:        Next steps: hook this list to Supabase (cms_blogs), wire filters, and add blog detail page with live preview.
../docs/01-product/admin/admin-gap-analysis.md:47:| `/admin/products` (+ `/:handle`) | `@admin/catalog/ui/pages/ProductsPage` | ‚úÖ | Supabase `cms_products`, `cms_product_media` | Most complete admin surface. |
../docs/01-product/admin/admin-gap-analysis.md:73:  - Supabase+Clerk JWT for `/admin/products` (good direction)
../docs/01-product/admin/admin-gap-analysis.md:78:- **RBAC enforced at the data layer** (Supabase RLS or API authorization).
../docs/01-product/admin/admin-gap-analysis.md:131:- Real load/save to Supabase `cms_products` + `cms_product_media`.
