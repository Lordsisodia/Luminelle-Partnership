../functions/api/customer/order.ts:13:  const shop = env.SHOPIFY_STORE_DOMAIN || ''
../functions/api/customer/orders.ts:9:  const shop = env.SHOPIFY_STORE_DOMAIN || ''
../functions/api/webhooks/clerk.ts:20:    console.error('Clerk webhook verification failed:', err)
../functions/api/shopify/auth.ts:15:  const apiKey = env.SHOPIFY_API_KEY || ''
../functions/api/shopify/auth.ts:16:  const scopes = env.SCOPES || env.SHOPIFY_SCOPES || 'read_products,write_products'
../functions/api/shopify/auth.ts:17:  const appUrl = env.SHOPIFY_APP_URL || url.origin
../functions/api/shopify/webhooks/customers-data-request.ts:14:    request.headers.get('X-Shopify-Shop-Domain') ||
../functions/api/shopify/webhooks/fulfillments-create.ts:5:import { isProcessed, markProcessed } from '../../../_lib/webhooks'
../functions/api/shopify/webhooks/fulfillments-create.ts:37:    request.headers.get('x-shopify-webhook-id') ||
../functions/api/shopify/webhooks/fulfillments-create.ts:38:    request.headers.get('X-Shopify-Webhook-Id') ||
../functions/api/shopify/webhooks/fulfillments-create.ts:44:    request.headers.get('X-Shopify-Shop-Domain') ||
../functions/api/shopify/webhooks/fulfillments-create.ts:107:        [{ id: userId, email: existing?.email ?? attrs.lumelle_user_email ?? null, updated_at: new Date().toISOString(), raw: { source: 'shopify_webhook' } }],
../functions/api/shopify/webhooks/orders-create.ts:3:import { hmacSha256Base64, safeEqual } from '../../../_lib/crypto'
../functions/api/shopify/webhooks/orders-create.ts:6:import { isProcessed, markProcessed } from '../../../_lib/webhooks'
../functions/api/shopify/webhooks/orders-create.ts:24:  const hmacHeader =
../functions/api/shopify/webhooks/orders-create.ts:25:    request.headers.get('x-shopify-hmac-sha256')?.trim() || request.headers.get('X-Shopify-Hmac-Sha256')?.trim() || ''
../functions/api/shopify/webhooks/orders-create.ts:26:  if (!hmacHeader) return text('Missing HMAC', { status: 401 })
../functions/api/shopify/webhooks/orders-create.ts:31:  // Shopify signs webhook payloads with the app secret (`SHOPIFY_API_SECRET`).
../functions/api/shopify/webhooks/orders-create.ts:32:  // Some deployments historically used a separate env var name (`SHOPIFY_WEBHOOK_SECRET`) which
../functions/api/shopify/webhooks/orders-create.ts:33:  // may or may not match. To avoid an env mismatch silently breaking all webhooks, accept either.
../functions/api/shopify/webhooks/orders-create.ts:34:  const apiSecret = env.SHOPIFY_API_SECRET || ''
../functions/api/shopify/webhooks/orders-create.ts:35:  const webhookSecret = env.SHOPIFY_WEBHOOK_SECRET || ''
../functions/api/shopify/webhooks/orders-create.ts:36:  if (!apiSecret && !webhookSecret) return text('Missing Shopify webhook secret', { status: 500 })
../functions/api/shopify/webhooks/orders-create.ts:38:  const computedApi = apiSecret ? await hmacSha256Base64(apiSecret, rawBody) : null
../functions/api/shopify/webhooks/orders-create.ts:40:    webhookSecret && webhookSecret !== apiSecret ? await hmacSha256Base64(webhookSecret, rawBody) : null
../functions/api/shopify/webhooks/orders-create.ts:42:    (computedApi && safeEqual(computedApi, hmacHeader)) || (computedWebhook && safeEqual(computedWebhook, hmacHeader)),
../functions/api/shopify/webhooks/orders-create.ts:78:            source: 'shopify_webhook',
../functions/api/shopify/webhooks/app-uninstalled.ts:14:    request.headers.get('X-Shopify-Shop-Domain') ||
../functions/api/shopify/webhooks/customers-redact.ts:14:    request.headers.get('X-Shopify-Shop-Domain') ||
../functions/api/shopify/webhooks/shop-redact.ts:14:    request.headers.get('X-Shopify-Shop-Domain') ||
../functions/api/shopify/webhooks/orders-updated.ts:5:import { isProcessed, markProcessed } from '../../../_lib/webhooks'
../functions/api/shopify/webhooks/orders-updated.ts:44:    request.headers.get('x-shopify-webhook-id') ||
../functions/api/shopify/webhooks/orders-updated.ts:45:    request.headers.get('X-Shopify-Webhook-Id') ||
../functions/api/shopify/webhooks/orders-updated.ts:51:    request.headers.get('X-Shopify-Shop-Domain') ||
../functions/api/shopify/webhooks/orders-updated.ts:86:          [{ id: userId, email: order.email ?? attrs.lumelle_user_email ?? null, updated_at: new Date().toISOString(), raw: { source: 'shopify_webhook' } }],
../functions/api/shopify/webhooks/customers-update.ts:5:import { isProcessed, markProcessed } from '../../../_lib/webhooks'
../functions/api/shopify/webhooks/customers-update.ts:15:    request.headers.get('x-shopify-webhook-id') ||
../functions/api/shopify/webhooks/customers-update.ts:16:    request.headers.get('X-Shopify-Webhook-Id') ||
../functions/api/shopify/webhooks/customers-update.ts:22:    request.headers.get('X-Shopify-Shop-Domain') ||
../functions/api/shopify/webhooks/customers-delete.ts:5:import { isProcessed, markProcessed } from '../../../_lib/webhooks'
../functions/api/shopify/webhooks/customers-delete.ts:15:    request.headers.get('x-shopify-webhook-id') ||
../functions/api/shopify/webhooks/customers-delete.ts:16:    request.headers.get('X-Shopify-Webhook-Id') ||
../functions/api/shopify/webhooks/customers-delete.ts:22:    request.headers.get('X-Shopify-Shop-Domain') ||
../functions/api/shopify/webhooks/customers-create.ts:5:import { isProcessed, markProcessed } from '../../../_lib/webhooks'
../functions/api/shopify/webhooks/customers-create.ts:15:    request.headers.get('x-shopify-webhook-id') ||
../functions/api/shopify/webhooks/customers-create.ts:16:    request.headers.get('X-Shopify-Webhook-Id') ||
../functions/api/shopify/webhooks/customers-create.ts:22:    request.headers.get('X-Shopify-Shop-Domain') ||
../functions/api/shopify/auth/callback.ts:26:      client_id: env.SHOPIFY_API_KEY,
../functions/api/shopify/auth/callback.ts:27:      client_secret: env.SHOPIFY_API_SECRET,
../functions/api/shopify/auth/callback.ts:50:  // Register shop webhooks (best-effort)
../functions/api/shopify/auth/callback.ts:51:  const webhookUrlBase = env.SHOPIFY_APP_URL || url.origin
../functions/api/shopify/auth/callback.ts:52:  const version = env.SHOPIFY_API_VERSION || '2025-10'
../functions/api/shopify/auth/callback.ts:56:        webhookSubscriptionCreate(topic: $topic, webhookSubscription: {callbackUrl: $callbackUrl, format: JSON}) {
../functions/api/shopify/auth/callback.ts:58:          webhookSubscription { id }
../functions/api/shopify/auth/callback.ts:63:      headers: { 'content-type': 'application/json', 'X-Shopify-Access-Token': tokenJson.access_token },
../functions/api/shopify/auth/callback.ts:64:      body: JSON.stringify({ query: mutation, variables: { topic, callbackUrl: `${webhookUrlBase}${callbackPath}` } }),
../functions/api/shopify/auth/callback.ts:69:    await createWebhook('CUSTOMERS_CREATE', '/api/shopify/webhooks/customers-create')
../functions/api/shopify/auth/callback.ts:70:    await createWebhook('CUSTOMERS_UPDATE', '/api/shopify/webhooks/customers-update')
../functions/api/shopify/auth/callback.ts:71:    await createWebhook('CUSTOMERS_DELETE', '/api/shopify/webhooks/customers-delete')
../functions/api/shopify/auth/callback.ts:72:    await createWebhook('APP_UNINSTALLED', '/api/shopify/webhooks/app-uninstalled')
../functions/api/shopify/auth/callback.ts:73:    await createWebhook('ORDERS_CREATE', '/api/shopify/webhooks/orders-create')
../functions/api/shopify/auth/callback.ts:74:    await createWebhook('ORDERS_UPDATED', '/api/shopify/webhooks/orders-updated')
../functions/api/shopify/auth/callback.ts:75:    await createWebhook('FULFILLMENTS_CREATE', '/api/shopify/webhooks/fulfillments-create')
../functions/api/cloudinary/sign.ts:44:  const signature = await sha1Hex(`${toSign}${apiSecret}`)
../functions/api/cloudinary/sign.ts:47:    signature,
../functions/api/customer-auth/start.ts:10:  const shop = (url.searchParams.get('shop') || env.SHOPIFY_STORE_DOMAIN || '').trim()
../functions/api/admin/sections/get.ts:14:  const shop = url.searchParams.get('shop') || env.SHOPIFY_STORE_DOMAIN || ''
../functions/api/admin/sections/update.ts:14:  const shop = url.searchParams.get('shop') || env.SHOPIFY_STORE_DOMAIN || ''
